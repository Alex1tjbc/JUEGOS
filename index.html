<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cazador: Nivel Gr谩fico 2</title>
    <style>
        :root { 
            --fondo-espacio: radial-gradient(circle at center, #1a1a2e 0%, #0a0e27 100%);
            /* Paleta de colores ne贸n */
            --neon-azul: #00f3ff;
            --neon-oro: #ffd700;
            --neon-rojo: #ff2e63;
        }
        body { 
            margin: 0; padding: 0; overflow: hidden; 
            background: var(--fondo-espacio); 
            font-family: 'Montserrat', sans-serif; /* Fuente m谩s moderna si estuviera disponible, si no usa fallback */
            perspective: 1200px; /* Perspectiva m谩s dram谩tica */
            touch-action: none;
        }
        
        #escenario { width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }

        /* --- MEJORA 1: CANCHA DE HIELO PREMIUM --- */
        #tablero {
            width: 90vw; height: 130vw; 
            /* Capas de fondo para efecto complejo */
            background-color: #e3f2fd;
            background-image: 
                /* Luz central */
                radial-gradient(circle at 50% 50%, rgba(255,255,255,0.8) 0%, rgba(187, 222, 251, 0.2) 60%, rgba(13, 71, 161, 0.5) 100%),
                /* Ruido sutil para textura */
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            background-blend-mode: overlay;

            border: 12px solid #fff; 
            /* Borde brillante futurista */
            box-shadow: 
                0 0 30px var(--neon-azul), /* Resplandor externo */
                inset 0 0 50px rgba(0, 168, 255, 0.3), /* Resplandor interno */
                0 50px 100px rgba(0,0,0,0.8); /* Sombra de elevaci贸n */
            border-radius: 35px; 
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
            overflow: hidden; /* Para contener los efectos */
        }
        /* Efecto de reflejo vidrioso sobre el tablero */
        #tablero::after {
            content: '';
            position: absolute; top:0; left:0; right:0; bottom:0;
            background: linear-gradient(135deg, rgba(255,255,255,0.4) 0%, transparent 50%, rgba(255,255,255,0.1) 100%);
            pointer-events: none;
        }

        /* --- MEJORA 2: AGUJEROS VOLUMTRICOS --- */
        .hoyo {
            position: absolute; 
            width: 70px; 
            height: 70px; 
            background: #000;
            border-radius: 50%; 
            /* Sombras internas profundas para simular profundidad 3D */
            box-shadow: 
                inset 0 15px 30px rgba(0,0,0,1), /* Sombra profunda superior */
                inset 0 -5px 15px rgba(50,0,100,0.5), /* Luz de rebote inferior */
                0 0 15px rgba(0,0,0,0.5), /* Sombra externa */
                0 0 5px var(--neon-rojo); /* Borde de peligro brillante */
            transform: translate(-50%, -50%);
            z-index: 1;
            overflow: hidden;
        }
        /* Efecto de v贸rtice dentro del hoyo */
        .hoyo::before {
            content: ''; position: absolute;
            width: 200%; height: 200%; top: -50%; left: -50%;
            background: conic-gradient(from 0deg, transparent, rgba(255, 46, 99, 0.3), transparent);
            animation: spinHoyo 3s linear infinite;
        }
        @keyframes spinHoyo { 100% { transform: rotate(360deg); }}

        .personaje {
            position: absolute; 
            font-size: 45px; 
            transform: translate(-50%, -50%);
            z-index: 8; 
            /* Sombra suave para que floten */
            filter: drop-shadow(0 8px 6px rgba(0,0,0,0.2));
            animation: flotar 2.5s ease-in-out infinite;
        }
        /* Los objetivos valiosos brillan */
        .objetivo-oro { filter: drop-shadow(0 0 15px var(--neon-oro)); }
        .objetivo-rojo { filter: drop-shadow(0 0 15px var(--neon-rojo)); }

        @keyframes flotar {
            0%, 100% { transform: translate(-50%, -50%) translateY(0px) rotate(0deg); }
            50% { transform: translate(-50%, -50%) translateY(-8px) rotate(3deg); }
        }

        #pelota {
            width: 52px; height: 52px; 
            position: absolute; 
            background-color: #fdfdfd;
            /* Patr贸n SVG del bal贸n (mismo del anterior) */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50 0 L65 25 L35 25 Z' fill='%23222'/%3E%3Cpath d='M50 100 L65 75 L35 75 Z' fill='%23222'/%3E%3Cpath d='M0 50 L25 35 L25 65 Z' fill='%23222'/%3E%3Cpath d='M100 50 L75 35 L75 65 Z' fill='%23222'/%3E%3Cpath d='M50 50 L62 58 L50 70 L38 58 Z' fill='%23222' opacity='0.9'/%3E%3Ccircle cx='50' cy='50' r='13' fill='%23222'/%3E%3C/svg%3E");
            background-size: cover;
            border-radius: 50%;
            z-index: 10; 
            /* Sombreado 3D mejorado */
            box-shadow: 
                inset -8px -8px 20px rgba(0,0,0,0.4),
                inset 5px 5px 15px rgba(255,255,255,0.9);
            transform: translate(-50%, -50%);
            will-change: transform;
        }
        /* Sombra separada del bal贸n para m谩s realismo */
        #sombra-pelota {
            position: absolute; width: 52px; height: 52px;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(1.1, 0.6); /* Aplastada */
            filter: blur(8px);
            z-index: 9;
        }

        /* --- MEJORA 3: PARTICULAS CSS --- */
        .particula {
            position: absolute;
            width: 8px; height: 8px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 15;
            animation: explosion 0.8s ease-out forwards;
        }
        @keyframes explosion {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(var(--vx), var(--vy)) scale(0); opacity: 0; }
        }

        /* --- MEJORA 4: UI CON ATMSFERA --- */
        #ui { 
            position: fixed; top: 20px; width: 100%; 
            text-align: center; color: white; z-index: 100; pointer-events: none;
        }
        #puntos-ui { 
            font-size: 2.2rem; font-weight: 800; color: var(--neon-oro);
            text-shadow: 0 0 20px var(--neon-oro); /* Bloom effect */
        }
        #timer-ui { 
            font-size: 3.2rem; font-weight: 900; margin: 5px 0; color: var(--neon-azul);
            text-shadow: 0 0 25px var(--neon-azul);
        }
        #dialogo { 
            font-size: 1.2rem; 
            background: rgba(10, 14, 39, 0.8); /* Fondo semitransparente oscuro */
            color: var(--neon-azul);
            padding: 10px 20px; border-radius: 30px; 
            display: inline-block; 
            backdrop-filter: blur(10px); /* Efecto de cristal esmerilado */
            border: 1px solid rgba(0, 243, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
        }
        
        .overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(5, 7, 20, 0.95);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 1000; color: white;
            backdrop-filter: blur(5px);
        }
        .btn { 
            padding: 25px 60px; 
            font-size: 1.6rem; text-transform: uppercase; letter-spacing: 2px;
            background: transparent; color: var(--neon-azul);
            border: 3px solid var(--neon-azul);
            border-radius: 50px; font-weight: 800; cursor: pointer; 
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.4);
            transition: all 0.3s;
        }
        .btn:hover { background: var(--neon-azul); color: #000; box-shadow: 0 0 60px var(--neon-azul); }
    </style>
</head>
<body>

<div id="ui">
    <div id="puntos-ui">SCORE: <span id="puntos">0</span></div>
    <div id="timer-ui"><span id="segundos">60</span></div>
    <p id="dialogo">Nivel Gr谩fico 2: 隆Listo!</p>
</div>

<div id="escenario">
    <div id="tablero">
        <div id="fx-container"></div>
        <div id="agujeros-container"></div>
        <div id="personajes-container"></div>
        <div id="sombra-pelota"></div>
        <div id="pelota"></div>
    </div>
</div>

<div id="intro" class="overlay">
    <h1 style="font-size:3rem; margin-bottom:10px; text-shadow: 0 0 30px var(--neon-azul);">NEON STRIKER</h1>
    <p style="text-align:center; padding:0 30px; line-height:1.6; font-size: 1.1rem; color: #ccc;">
        Los gr谩ficos han evolucionado.<br>Inclina para rodar.<br><br>
        <span style="color:var(--neon-azul)"> +10</span> | 
        <span style="color:var(--neon-azul)"> +20</span> | 
        <span style="color:var(--neon-oro); text-shadow:0 0 10px var(--neon-oro)"> +50</span> | 
        <span style="color:var(--neon-rojo)"> -30</span>
    </p>
    <button class="btn" onclick="iniciarJuego()">DESPEGAR</button>
</div>

<script>
    let x = 50, y = 50, vx = 0, vy = 0;
    let incliX = 0, incliY = 0, juegoActivo = false;
    let puntos = 0, segundos = 60;
    let rotacionAcumulada = 0;

    const tiposPersonajes = [
        { emoji: "", valor: 10, prob: 0.4, speed: 0.5, colorFn: '#00f3ff' },
        { emoji: "", valor: 20, prob: 0.3, speed: 0.8, colorFn: '#00f3ff' },
        { emoji: "", valor: 50, prob: 0.1, speed: 1.3, claseExtra: 'objetivo-oro', colorFn: '#ffd700' },
        { emoji: "", valor: -30, prob: 0.2, speed: 1.0, claseExtra: 'objetivo-rojo', colorFn: '#ff2e63' }
    ];

    let personajesEnJuego = {};
    const frases = ["隆Excelente!", "隆Imparable!", "隆Avanza!", "隆Cuidado ah铆!"];

    // --- NUEVA FUNCIN: SISTEMA DE PARTCULAS ---
    function crearExplosion(posX, posY, color) {
        const fxCont = document.getElementById('fx-container');
        const numParticulas = 15; // Cantidad de part铆culas
        
        for (let i = 0; i < numParticulas; i++) {
            let part = document.createElement('div');
            part.className = 'particula';
            part.style.left = posX + "%";
            part.style.top = posY + "%";
            part.style.backgroundColor = color;
            part.style.boxShadow = `0 0 10px ${color}`;
            
            // Velocidad y direcci贸n aleatoria para la explosi贸n
            let angle = Math.random() * Math.PI * 2;
            let velocity = 30 + Math.random() * 50; // Distancia de explosi贸n
            let moveX = Math.cos(angle) * velocity + 'px';
            let moveY = Math.sin(angle) * velocity + 'px';
            
            // Usamos variables CSS para pasar los valores a la animaci贸n
            part.style.setProperty('--vx', moveX);
            part.style.setProperty('--vy', moveY);

            fxCont.appendChild(part);

            // Limpieza: eliminar part铆cula del DOM despu茅s de la animaci贸n
            setTimeout(() => part.remove(), 800);
        }
    }

    async function iniciarJuego() {
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            try {
                const res = await DeviceOrientationEvent.requestPermission();
                if (res === 'granted') arrancarJuego();
                else alert("Permiso de giroscopio denegado. No podr谩s mover el bal贸n.");
            } catch (e) { arrancarJuego(); }
        } else { arrancarJuego(); }
    }

    function arrancarJuego() {
        document.getElementById('intro').style.display = 'none';
        juegoActivo = true;
        x = 50; y = 50; vx = 0; vy = 0; segundos = 60; puntos = 0;
        actualizarUI();
        window.addEventListener('deviceorientation', manejarOrientacion);
        generarAgujeros();
        setInterval(spawnPersonaje, 1400);
        contarTiempo();
        gameLoop();
    }

    function manejarOrientacion(e) {
        incliX = e.gamma || 0; 
        incliY = e.beta || 0; 
        incliX = Math.max(-40, Math.min(40, incliX));
        incliY = Math.max(-40, Math.min(40, incliY));
    }

    function generarAgujeros() {
        const agCont = document.getElementById('agujeros-container');
        agCont.innerHTML = '';
        const posiciones = [{L:20,T:25}, {L:80,T:25}, {L:50,T:75}];
        posiciones.forEach(pos => {
            let div = document.createElement('div');
            div.className = 'hoyo';
            div.style.left = pos.L + "%"; div.style.top = pos.T + "%";
            agCont.appendChild(div);
        });
    }

    function spawnPersonaje() {
        if (!juegoActivo) return;
        let rand = Math.random(), acumulado = 0, tipoElegido = tiposPersonajes[0];
        for (const tipo of tiposPersonajes) {
            acumulado += tipo.prob;
            if (rand <= acumulado) { tipoElegido = tipo; break; }
        }
        let cX = 10 + Math.random()*80, cY = 10 + Math.random()*80;
        if (Math.abs(cX-50)<15 && Math.abs(cY-50)<15) return;

        let id = Date.now() + Math.random();
        let div = document.createElement('div');
        div.className = 'personaje ' + (tipoElegido.claseExtra || '');
        div.id = 'char-' + id;
        div.style.left = cX + "%"; div.style.top = cY + "%";
        div.innerText = tipoElegido.emoji;
        document.getElementById('personajes-container').appendChild(div);
        personajesEnJuego[id] = { x: cX, y: cY, vx: (Math.random()-0.5)*tipoElegido.speed, vy: (Math.random()-0.5)*tipoElegido.speed, tipo: tipoElegido };
    }

    function actualizarUI() {
        document.getElementById('puntos').innerText = puntos;
        document.getElementById('segundos').innerText = segundos;
    }

    function contarTiempo() {
        if (!juegoActivo) return;
        if (segundos <= 0) finalizarJuego(true);
        else { segundos--; actualizarUI(); setTimeout(contarTiempo, 1000); }
    }

    function gameLoop() {
        if (!juegoActivo) return;
        vx += incliX * 0.09; vy += incliY * 0.09;
        vx *= 0.91; vy *= 0.91;
        x += vx * 0.1; y += vy * 0.1;

        let velocidad = Math.sqrt(vx*vx + vy*vy);
        rotacionAcumulada += velocidad * 6;

        const pelota = document.getElementById('pelota');
        const sombra = document.getElementById('sombra-pelota');
        const tablero = document.getElementById('tablero');
        
        pelota.style.left = x + "%"; pelota.style.top = y + "%";
        pelota.style.transform = `translate(-50%, -50%) rotate(${rotacionAcumulada}deg)`;
        
        // La sombra sigue al bal贸n pero sin rotar
        sombra.style.left = x + "%"; sombra.style.top = (y + 1) + "%"; // +1 para offset vertical

        tablero.style.transform = `rotateX(${-incliY*0.4}deg) rotateY(${incliX*0.4}deg) scale(1.02)`;

        for (let id in personajesEnJuego) {
            let p = personajesEnJuego[id];
            p.x += p.vx; p.y += p.vy;
            if (p.x<6 || p.x>94) p.vx*=-1; if (p.y<6 || p.y>94) p.vy*=-1;
            let charDiv = document.getElementById('char-' + id);
            if (charDiv) {
                charDiv.style.left = p.x + "%"; charDiv.style.top = p.y + "%";
                if (Math.sqrt(Math.pow(x-p.x,2)+Math.pow(y-p.y,2)) < 6.5) { 
                    puntos += p.tipo.valor;
                    actualizarUI();
                    // DISPARAR PARTICULAS
                    crearExplosion(p.x, p.y, p.tipo.colorFn);
                    document.getElementById('dialogo').innerText = p.tipo.valor > 0 ? frases[Math.floor(Math.random()*3)] : "隆Auch!";
                    charDiv.remove(); delete personajesEnJuego[id];
                }
            }
        }

        document.querySelectorAll('.hoyo').forEach(hoyo => {
            let hR = hoyo.getBoundingClientRect(), tR = tablero.getBoundingClientRect();
            let hX = ((hR.left+hR.width/2-tR.left)/tR.width)*100;
            let hY = ((hR.top+hR.height/2-tR.top)/tR.height)*100;
            if (Math.sqrt(Math.pow(x-hX,2)+Math.pow(y-hY,2)) < 4.5) finalizarJuego(false);
        });

        if (x<2 || x>98) { vx*=-1; x = x<2?2:98; }
        if (y<2 || y>98) { vy*=-1; y = y<2?2:98; }

        requestAnimationFrame(gameLoop);
    }

    function finalizarJuego(ganaste) {
        juegoActivo = false;
        document.getElementById('intro').style.display = 'flex';
        document.querySelector('#intro h1').innerText = ganaste ? "隆TIEMPO TERMINADO!" : "隆CASTE AL VACO!";
        document.querySelector('#intro p').innerHTML = `Puntuaci贸n Final: <span style="color:var(--neon-oro); font-size:1.5rem">${puntos}</span><br>驴Otra partida?`;
        document.querySelector('#intro .btn').innerText = "REINTENTAR";
    }
</script>
</body>
</html>
