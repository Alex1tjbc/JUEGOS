<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Striker: Versi√≥n Estable</title>
    <style>
        :root { 
            --bg-color: #121212;
            --neon-azul: #00f3ff;
            --neon-rojo: #ff0055;
            --neon-verde: #00ff66;
            --neon-amarillo: #ffdd00;
        }
        body { 
            margin: 0; padding: 0; overflow: hidden; 
            background: #000; 
            font-family: 'Arial', sans-serif; 
            touch-action: none;
            user-select: none;
        }
        
        /* INTERFAZ DE USUARIO (UI) */
        #ui-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: 80px;
            background: rgba(0,0,0,0.8);
            display: flex; justify-content: space-around; align-items: center;
            z-index: 100; border-bottom: 2px solid var(--neon-azul);
            color: white; font-weight: bold;
        }
        .stat-box { text-align: center; }
        .stat-val { font-size: 1.5rem; margin-top: 5px; }
        #vidas-val { letter-spacing: 5px; }

        /* EL JUEGO */
        #game-area {
            position: absolute; top: 0; left: 0; width: 100vw; height: 100vh;
            display: flex; align-items: center; justify-content: center;
            perspective: 1000px;
        }

        #tablero {
            width: 90vw; height: 130vw; /* Proporci√≥n vertical para m√≥viles */
            max-height: 85vh; max-width: 60vh; /* L√≠mite para PC */
            background: radial-gradient(circle at center, #222, #000);
            border: 4px solid var(--neon-azul);
            box-shadow: 0 0 20px var(--neon-azul), inset 0 0 50px rgba(0,0,0,0.9);
            border-radius: 15px;
            position: relative;
            transform-style: preserve-3d;
            overflow: hidden;
        }
        /* Rejilla de fondo para sensaci√≥n de movimiento */
        #tablero::after {
            content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            z-index: 0;
            pointer-events: none;
        }

        /* ELEMENTOS DEL JUEGO */
        .elemento {
            position: absolute; 
            transform: translate(-50%, -50%);
            z-index: 10;
            font-size: 35px;
            /* Transici√≥n suave solo para posici√≥n si se mueve por JS, no CSS directo */
        }
        
        /* BAL√ìN - CSS PURO (Garantizado que se ve) */
        #pelota {
            width: 40px; height: 40px;
            position: absolute;
            background: radial-gradient(circle at 30% 30%, #ffffff 0%, #dddddd 20%, #000000 100%);
            border-radius: 50%;
            z-index: 20;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transform: translate(-50%, -50%);
            /* Una marca negra para ver que rueda */
            display: flex; align-items: center; justify-content: center;
        }
        #pelota::after {
            content: '‚öΩ'; font-size: 24px; opacity: 0.8;
        }

        /* HOYOS */
        .hoyo {
            position: absolute;
            width: 60px; height: 60px;
            background: black;
            border-radius: 50%;
            border: 2px solid var(--neon-rojo);
            box-shadow: inset 0 0 15px #000;
            transform: translate(-50%, -50%);
            z-index: 5;
        }
        .hoyo::before { content: '‚ò†Ô∏è'; position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size: 20px; opacity: 0.5; }

        /* PARTICULAS */
        .particula {
            position: absolute; width: 8px; height: 8px; border-radius: 50%; pointer-events: none; z-index: 30;
        }

        /* PANTALLAS */
        .overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.95);
            color: white; z-index: 200;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center;
        }
        .btn {
            background: var(--neon-verde); color: black;
            padding: 15px 40px; font-size: 20px; font-weight: bold;
            border: none; border-radius: 30px; margin-top: 20px;
            cursor: pointer; box-shadow: 0 0 15px var(--neon-verde);
        }
        .hidden { display: none !important; }

        /* Tarjeta roja loca */
        .furiosa {
            filter: drop-shadow(0 0 10px red);
            animation: shake 0.2s infinite;
        }
        @keyframes shake { 0% { transform: translate(-52%, -52%); } 100% { transform: translate(-48%, -48%); } }

    </style>
</head>
<body>

<div id="ui-bar">
    <div class="stat-box"><div style="color:var(--neon-rojo)">VIDAS</div><div id="vidas-val" class="stat-val">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div></div>
    <div class="stat-box"><div style="color:var(--neon-azul)">TIEMPO</div><div id="tiempo-val" class="stat-val">60</div></div>
    <div class="stat-box"><div style="color:var(--neon-amarillo)">PUNTOS</div><div id="puntos-val" class="stat-val">0</div></div>
</div>

<div id="game-area">
    <div id="tablero">
        <div id="capa-hoyos"></div>
        <div id="capa-items"></div>
        <div id="capa-fx"></div>
        <div id="pelota"></div>
    </div>
</div>

<div id="pantalla-inicio" class="overlay">
    <h1 style="color:var(--neon-azul); font-size: 3rem; margin:0;">NEON STRIKER</h1>
    <h3 style="color:#aaa;">EDICI√ìN ARCADE ESTABLE</h3>
    <div style="text-align:left; padding:20px; line-height: 1.8;">
        ‚Ä¢ Mueve el celular (o flechas teclado).<br>
        ‚Ä¢ Evita hoyos negros (‚ò†Ô∏è).<br>
        ‚Ä¢ Tienes 3 vidas contra tarjetas rojas (üü•).<br>
        ‚Ä¢ Atrapa caras (üòÄ) y copas (üèÜ).
    </div>
    <button class="btn" onclick="iniciarJuego()">¬°JUGAR!</button>
</div>

<div id="pantalla-fin" class="overlay hidden">
    <h1 id="titulo-fin" style="color:var(--neon-rojo)">GAME OVER</h1>
    <p style="font-size:1.5rem">Puntos: <span id="score-final" style="color:var(--neon-amarillo)">0</span></p>
    <button class="btn" onclick="location.reload()">REINTENTAR</button>
</div>

<script>
    // --- CONFIGURACI√ìN ---
    const config = {
        velocidad: 0.15,
        friccion: 0.94,
        radioPelota: 3, // % del tablero (aprox)
        radioColision: 5, // % distancia para tocar items
        radioHoyo: 4      // % distancia para caer
    };

    // --- ESTADO DEL JUEGO ---
    let estado = {
        jugando: false,
        x: 50, y: 50, // Posici√≥n pelota (0-100%)
        vx: 0, vy: 0, // Velocidad
        incliX: 0, incliY: 0, // Sensores
        puntos: 0,
        vidas: 3,
        tiempo: 60,
        rotacion: 0
    };

    let items = []; // Array de objetos {id, x, y, tipo, vx, vy, el}
    let hoyos = []; // Array de objetos {x, y}

    // --- AUDIO SINTETIZADO (Simple y divertido) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function beep(frecuencia, tipo, duracion) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = tipo;
        osc.frequency.value = frecuencia;
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duracion);
        osc.stop(audioCtx.currentTime + duracion);
    }
    const sfx = {
        bien: () => { beep(800, 'sine', 0.1); setTimeout(()=>beep(1200,'sine',0.2), 100); },
        mal: () => { beep(150, 'sawtooth', 0.3); },
        muerte: () => { beep(100, 'square', 1.0); },
        pop: () => { beep(600, 'triangle', 0.05); }
    };

    // --- INICIO ---
    function iniciarJuego() {
        // Pedir permisos iOS
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
                .then(res => { if (res === 'granted') arrancarMotor(); })
                .catch(console.error);
        } else {
            arrancarMotor();
        }
    }

    function arrancarMotor() {
        document.getElementById('pantalla-inicio').classList.add('hidden');
        estado.jugando = true;
        
        // Listeners
        window.addEventListener('deviceorientation', manejarGiroscopio);
        window.addEventListener('keydown', manejarTeclado); // Soporte PC

        // Generar Nivel
        crearHoyosSeguros();
        actualizarHUD();

        // Loops
        requestAnimationFrame(gameLoop);
        setInterval(spawnItem, 1500);
        setInterval(reloj, 1000);
    }

    // --- LOGICA DE CONTROL ---
    function manejarGiroscopio(e) {
        // Limitar inclinaci√≥n para que no se vaya muy r√°pido
        estado.incliX = Math.min(30, Math.max(-30, e.gamma || 0)); 
        estado.incliY = Math.min(30, Math.max(-30, e.beta || 0));
    }
    
    function manejarTeclado(e) {
        // Simular inclinaci√≥n con teclas
        if(e.key === 'ArrowRight') estado.incliX = 20;
        if(e.key === 'ArrowLeft') estado.incliX = -20;
        if(e.key === 'ArrowUp') estado.incliY = -20;
        if(e.key === 'ArrowDown') estado.incliY = 20;
        // Soltar teclas resetea (opcional, pero ayuda a controlar)
        setTimeout(() => { 
            if(e.key.includes('Arrow')) { estado.incliX=0; estado.incliY=0; }
        }, 300);
    }

    // --- GENERACI√ìN SEGURA ---
    function crearHoyosSeguros() {
        const divHoyos = document.getElementById('capa-hoyos');
        divHoyos.innerHTML = '';
        hoyos = [
            {x: 20, y: 20}, // Esquina Sup Izq
            {x: 80, y: 20}, // Esquina Sup Der
            {x: 20, y: 80}, // Esquina Inf Izq
            {x: 80, y: 80}  // Esquina Inf Der
        ];
        
        hoyos.forEach(h => {
            let el = document.createElement('div');
            el.className = 'hoyo';
            el.style.left = h.x + '%';
            el.style.top = h.y + '%';
            divHoyos.appendChild(el);
        });
    }

    function spawnItem() {
        if(!estado.jugando) return;
        
        // Tipos de items
        const tabla = [
            {emoji:'üòÄ', val:10, type:'ok', speed:0.3},
            {emoji:'üòÄ', val:10, type:'ok', speed:0.3},
            {emoji:'üèÜ', val:50, type:'ok', speed:0.8},
            {emoji:'üü•', val:-1, type:'bad', speed:0.6}
        ];
        const elegido = tabla[Math.floor(Math.random() * tabla.length)];

        // Posici√≥n aleatoria pero LEJOS del centro al nacer
        let nx, ny;
        do {
            nx = 10 + Math.random() * 80;
            ny = 10 + Math.random() * 80;
        } while (Math.abs(nx - 50) < 15 && Math.abs(ny - 50) < 15); // Zona segura centro

        let div = document.createElement('div');
        div.className = 'elemento';
        div.innerText = elegido.emoji;
        div.style.left = nx + '%'; div.style.top = ny + '%';
        if(elegido.emoji === 'üü•') div.style.textShadow = "0 0 10px red";
        
        document.getElementById('capa-items').appendChild(div);

        items.push({
            el: div,
            x: nx, y: ny,
            vx: (Math.random()-0.5)*elegido.speed,
            vy: (Math.random()-0.5)*elegido.speed,
            tipo: elegido.type,
            val: elegido.val,
            furioso: false
        });
    }

    // --- LOOP PRINCIPAL ---
    function gameLoop() {
        if(!estado.jugando) return;

        // 1. F√çSICA PELOTA
        estado.vx += estado.incliX * 0.005; // Sensibilidad
        estado.vy += estado.incliY * 0.005;
        estado.vx *= config.friccion;
        estado.vy *= config.friccion;

        estado.x += estado.vx;
        estado.y += estado.vy;

        // Rebote paredes
        if(estado.x <= 2 || estado.x >= 98) { estado.vx *= -0.6; estado.x = estado.x < 2 ? 2 : 98; }
        if(estado.y <= 2 || estado.y >= 98) { estado.vy *= -0.6; estado.y = estado.y < 2 ? 2 : 98; }

        // Rotaci√≥n visual
        estado.rotacion += Math.sqrt(estado.vx*estado.vx + estado.vy*estado.vy) * 10;
        
        // Render Pelota
        const bola = document.getElementById('pelota');
        bola.style.left = estado.x + '%';
        bola.style.top = estado.y + '%';
        bola.style.transform = `translate(-50%, -50%) rotate(${estado.rotacion}deg)`;
        
        // Inclinaci√≥n visual Tablero
        const tab = document.getElementById('tablero');
        tab.style.transform = `rotateX(${-estado.incliY * 0.5}deg) rotateY(${estado.incliX * 0.5}deg)`;

        // 2. COLISI√ìN HOYOS (Muerte instant√°nea)
        for(let h of hoyos) {
            let dx = estado.x - h.x;
            let dy = estado.y - h.y;
            let dist = Math.sqrt(dx*dx + dy*dy);
            if(dist < config.radioHoyo) {
                gameOver("¬°Ca√≠ste al vac√≠o!");
                return;
            }
        }

        // 3. L√ìGICA ITEMS
        for (let i = items.length - 1; i >= 0; i--) {
            let it = items[i];
            
            // Movimiento Item
            it.x += it.vx; it.y += it.vy;
            // Rebote item
            if(it.x < 5 || it.x > 95) it.vx *= -1;
            if(it.y < 5 || it.y > 95) it.vy *= -1;
            
            // Render item
            it.el.style.left = it.x + '%';
            it.el.style.top = it.y + '%';

            // Colisi√≥n con Pelota
            let dx = estado.x - it.x;
            let dy = estado.y - it.y;
            let dist = Math.sqrt(dx*dx + dy*dy);

            if(dist < config.radioColision) {
                if(it.tipo === 'ok') {
                    // COSA BUENA: Sumar y borrar
                    estado.puntos += it.val;
                    crearExplosion(it.x, it.y, '#ffdd00');
                    sfx.bien();
                    it.el.remove();
                    items.splice(i, 1);
                } else {
                    // COSA MALA (Roja)
                    if(!it.furioso) { // Solo golpea si no est√° furiosa a√∫n (o resetear l√≥gica de hit)
                        // Para simplificar: al tocarla, te quita vida y se vuelve furiosa
                        estado.vidas--;
                        sfx.mal();
                        crearExplosion(it.x, it.y, '#ff0000');
                        
                        if(estado.vidas <= 0) {
                            gameOver("Tarjeta Roja: Expulsado");
                            return;
                        }

                        // Modo Furia
                        it.furioso = true;
                        it.vx *= 3; // Mucho m√°s r√°pida
                        it.vy *= 3;
                        it.el.classList.add('furiosa'); // Efecto visual
                        // Empujar pelota lejos
                        estado.vx = -estado.vx * 2;
                        estado.vy = -estado.vy * 2;
                        
                        // Truco: Mover item lejos para no quitar todas las vidas de golpe
                        it.x = (it.x + 50) % 100;
                        it.y = (it.y + 50) % 100;
                    }
                }
                actualizarHUD();
            }
        }

        requestAnimationFrame(gameLoop);
    }

    // --- UTILS ---
    function crearExplosion(x, y, color) {
        const capa = document.getElementById('capa-fx');
        for(let k=0; k<10; k++) {
            let p = document.createElement('div');
            p.className = 'particula';
            p.style.backgroundColor = color;
            p.style.left = x + '%'; p.style.top = y + '%';
            
            // Dispersi√≥n
            let angle = Math.random() * Math.PI * 2;
            let speed = 20 + Math.random() * 30;
            let tx = Math.cos(angle) * speed;
            let ty = Math.sin(angle) * speed;
            
            p.animate([
                { transform: 'translate(0,0) scale(1)', opacity: 1 },
                { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }
            ], { duration: 500 });
            
            capa.appendChild(p);
            setTimeout(() => p.remove(), 500);
        }
    }

    function actualizarHUD() {
        document.getElementById('puntos-val').innerText = estado.puntos;
        let corazones = "";
        for(let i=0; i<estado.vidas; i++) corazones += "‚ù§Ô∏è";
        document.getElementById('vidas-val').innerText = corazones;
    }

    function reloj() {
        if(!estado.jugando) return;
        estado.tiempo--;
        document.getElementById('tiempo-val').innerText = estado.tiempo;
        if(estado.tiempo <= 0) gameOver("¬°Tiempo Fuera!");
    }

    function gameOver(razon) {
        estado.jugando = false;
        sfx.muerte();
        document.getElementById('pantalla-fin').classList.remove('hidden');
        document.getElementById('titulo-fin').innerText = razon;
        document.getElementById('score-final').innerText = estado.puntos;
    }

</script>
</body>
</html>
