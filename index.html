<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Striker: Arcade Edition</title>
    <style>
        :root { 
            --fondo-espacio: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%);
            --neon-azul: #00f3ff;
            --neon-oro: #ffd700;
            --neon-rojo: #ff003c;
            --neon-verde: #00ff66;
        }
        body { 
            margin: 0; padding: 0; overflow: hidden; 
            background: var(--fondo-espacio); 
            font-family: 'Segoe UI', sans-serif; 
            perspective: 1200px; 
            touch-action: none;
            user-select: none;
        }
        
        #escenario { width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }

        /* TABLERO AVANZADO */
        #tablero {
            width: 90vw; height: 130vw; 
            background-color: #121212;
            /* Grilla Cyberpunk */
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            border: 8px solid #fff; 
            box-shadow: 
                0 0 20px var(--neon-azul),
                inset 0 0 60px rgba(0,0,0,0.8);
            border-radius: 20px; 
            position: relative;
            transform-style: preserve-3d;
            overflow: hidden;
        }

        /* HOYOS DE MUERTE INSTANT√ÅNEA */
        .hoyo {
            position: absolute; 
            width: 70px; height: 70px; 
            background: #000;
            border-radius: 50%; 
            box-shadow: inset 0 0 20px #000, 0 0 10px var(--neon-rojo);
            transform: translate(-50%, -50%);
            z-index: 1;
        }
        .hoyo::after {
            content: "‚ò†Ô∏è"; position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size: 30px; opacity: 0.5;
        }

        /* PERSONAJES */
        .personaje {
            position: absolute; font-size: 42px; 
            transform: translate(-50%, -50%); z-index: 8; 
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));
            will-change: transform, left, top;
        }
        .roja-furiosa {
            filter: drop-shadow(0 0 15px var(--neon-rojo)) hue-rotate(45deg);
            animation: vibrar 0.1s infinite;
        }
        @keyframes vibrar {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-52%, -52%) rotate(-5deg); }
            75% { transform: translate(-48%, -48%) rotate(5deg); }
            100% { transform: translate(-50%, -50%) rotate(0deg); }
        }

        /* BAL√ìN REALISTA */
        #pelota {
            width: 50px; height: 50px; 
            position: absolute; 
            background: radial-gradient(circle at 30% 30%, #fff, #ddd 40%, #333 100%);
            /* Textura de hex√°gonos CSS */
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 0 L20 5 L20 15 L10 20 L0 15 L0 5 Z' fill='none' stroke='rgba(0,0,0,0.8)' stroke-width='1'/%3E%3C/svg%3E");
            border-radius: 50%;
            z-index: 10; 
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
            transform: translate(-50%, -50%);
        }

        /* UI SUPERIOR */
        #ui { 
            position: fixed; top: 10px; width: 100%; 
            display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box;
            z-index: 100; pointer-events: none;
            text-shadow: 0 2px 4px rgba(0,0,0,0.9);
            font-weight: 900;
        }
        .ui-box { text-align: center; }
        #vidas-ui { font-size: 2rem; letter-spacing: 5px; }
        #puntos-ui { color: var(--neon-oro); font-size: 1.8rem; }
        #timer-ui { color: var(--neon-azul); font-size: 1.8rem; }
        
        #dialogo-container {
            position: fixed; top: 80px; width: 100%; text-align: center; pointer-events: none; z-index: 99;
        }
        #dialogo {
            background: rgba(0,0,0,0.7); color: #fff; padding: 8px 16px; border-radius: 20px;
            display: inline-block; font-size: 1.2rem;
            border: 1px solid var(--neon-azul);
        }

        /* PANTALLA INTRO / GAME OVER */
        .overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.95);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 1000; color: white;
            backdrop-filter: blur(5px);
        }
        .btn { 
            padding: 20px 50px; font-size: 1.5rem; 
            background: var(--neon-verde); color: #000; border: none; 
            border-radius: 50px; font-weight: bold; cursor: pointer; margin-top: 20px;
            box-shadow: 0 0 20px var(--neon-verde);
            animation: pulsoBtn 1s infinite;
        }
        @keyframes pulsoBtn { 50% { transform: scale(1.05); } }

        /* PARTICULAS */
        .particula {
            position: absolute; width: 10px; height: 10px; border-radius: 50%; pointer-events: none; z-index: 20;
        }
    </style>
</head>
<body>

<div id="ui">
    <div class="ui-box">VIDAS<br><div id="vidas-ui">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div></div>
    <div class="ui-box">TIEMPO<br><div id="timer-ui">60</div></div>
    <div class="ui-box">PUNTOS<br><div id="puntos-ui">0</div></div>
</div>

<div id="dialogo-container"><div id="dialogo">¬°Inclina para rodar!</div></div>

<div id="escenario">
    <div id="tablero">
        <div id="fx-layer"></div>
        <div id="agujeros-container"></div>
        <div id="personajes-container"></div>
        <div id="pelota"></div>
    </div>
</div>

<div id="intro" class="overlay">
    <h1 style="color:var(--neon-azul); font-size: 2.5rem; text-align: center;">NEON STRIKER<br><span style="font-size:1.5rem; color:#fff;">ARCADE EDITION</span></h1>
    <div style="text-align:left; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 10px;">
        <p>üî¥ <strong>Tarjetas Rojas:</strong> Pierdes 1 vida. ¬°Explotan y se vuelven locas!</p>
        <p>‚ò†Ô∏è <strong>Hoyos Negros:</strong> Game Over inmediato.</p>
        <p>üôÇ <strong>Caritas/Copas:</strong> Suma puntos y desaparecen.</p>
        <p>üîä <strong>Sonido:</strong> ¬°Activado!</p>
    </div>
    <button class="btn" onclick="iniciarJuego()">¬°JUGAR AHORA!</button>
</div>

<script>
    // --- MOTOR DE AUDIO SINTETIZADO (Sin archivos externos) ---
    const AudioEngine = {
        ctx: null,
        init: function() {
            window.AudioContext = window.AudioContext || window.webkitAudioContext;
            this.ctx = new AudioContext();
        },
        playTone: function(freq, type, duration, vol=0.1) {
            if (!this.ctx) return;
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
            gain.gain.setValueAtTime(vol, this.ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            osc.start();
            osc.stop(this.ctx.currentTime + duration);
        },
        playNoise: function(duration) {
            if (!this.ctx) return;
            const bufferSize = this.ctx.sampleRate * duration;
            const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
            const noise = this.ctx.createBufferSource();
            noise.buffer = buffer;
            const gain = this.ctx.createGain();
            gain.gain.setValueAtTime(0.2, this.ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
            noise.connect(gain);
            gain.connect(this.ctx.destination);
            noise.start();
        },
        sonidoMoneda: function() { this.playTone(1200, 'sine', 0.1); setTimeout(()=>this.playTone(1800, 'sine', 0.2), 50); },
        sonidoGolpe: function() { this.playTone(150, 'sawtooth', 0.3); this.playNoise(0.2); },
        sonidoCopa: function() { this.playTone(600, 'square', 0.1); setTimeout(()=>this.playTone(900, 'square', 0.4), 100); },
        sonidoGameOver: function() { this.playTone(300, 'sawtooth', 0.5); setTimeout(()=>this.playTone(250, 'sawtooth', 0.5), 400); setTimeout(()=>this.playTone(100, 'sawtooth', 1.0), 800); }
    };

    // --- VARIABLES DE JUEGO ---
    let x = 50, y = 50, vx = 0, vy = 0;
    let incliX = 0, incliY = 0, juegoActivo = false;
    let puntos = 0, segundos = 60, vidas = 3;
    let rotacionPelota = 0;

    const tipos = [
        { emoji: "üòÄ", valor: 10, prob: 0.4, speed: 0.5, tipo: 'bueno' },
        { emoji: "üòé", valor: 20, prob: 0.3, speed: 0.8, tipo: 'bueno' },
        { emoji: "üèÜ", valor: 50, prob: 0.1, speed: 1.2, tipo: 'bueno' },
        { emoji: "üü•", valor: -1, prob: 0.2, speed: 0.7, tipo: 'malo' } // Valor -1 es quitar vida
    ];

    let entidades = {};

    // --- FUNCIONES CORE ---
    async function iniciarJuego() {
        AudioEngine.init(); // Iniciar motor de audio
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            try { await DeviceOrientationEvent.requestPermission(); } catch (e) {}
        }
        document.getElementById('intro').style.display = 'none';
        resetJuego();
        window.addEventListener('deviceorientation', e => {
            incliX = Math.min(40, Math.max(-40, e.gamma || 0));
            incliY = Math.min(40, Math.max(-40, e.beta || 0));
        });
        
        setInterval(spawnEntidad, 1200);
        loop();
        contarTiempo();
    }

    function resetJuego() {
        juegoActivo = true;
        x = 50; y = 50; vx = 0; vy = 0;
        puntos = 0; segundos = 60; vidas = 3;
        entidades = {};
        document.getElementById('personajes-container').innerHTML = '';
        actualizarUI();
        generarHoyos();
        mostrarMensaje("¬°A RODAR!");
    }

    function spawnEntidad() {
        if (!juegoActivo) return;
        
        // Selecci√≥n aleatoria ponderada
        let rand = Math.random(), acumulado = 0, elegido = tipos[0];
        for (let t of tipos) {
            acumulado += t.prob;
            if (rand <= acumulado) { elegido = t; break; }
        }

        let ex = 10 + Math.random()*80, ey = 10 + Math.random()*80;
        if (Math.abs(ex-50)<10 && Math.abs(ey-50)<10) return; // No spawnear encima del jugador

        let id = 'e-' + Date.now() + Math.random();
        let el = document.createElement('div');
        el.className = 'personaje';
        if (elegido.emoji === "üü•") el.style.filter = "drop-shadow(0 0 5px red)";
        el.innerText = elegido.emoji;
        el.style.left = ex + "%"; el.style.top = ey + "%";
        document.getElementById('personajes-container').appendChild(el);

        entidades[id] = {
            id: id,
            el: el,
            x: ex, y: ey,
            vx: (Math.random()-0.5) * elegido.speed,
            vy: (Math.random()-0.5) * elegido.speed,
            data: elegido,
            cooldown: 0 // Para no golpear 60 veces por segundo
        };
    }

    function generarHoyos() {
        const c = document.getElementById('agujeros-container');
        c.innerHTML = '';
        // 3 Hoyos estrat√©gicos
        [{x:20,y:20}, {x:80,y:80}, {x:50,y:50}].forEach(pos => {
            let h = document.createElement('div');
            h.className = 'hoyo';
            h.style.left = pos.x + "%"; h.style.top = pos.y + "%";
            c.appendChild(h);
        });
    }

    function crearExplosion(x, y, color) {
        const layer = document.getElementById('fx-layer');
        for(let i=0; i<12; i++) {
            let p = document.createElement('div');
            p.className = 'particula';
            p.style.backgroundColor = color;
            p.style.left = x + "%"; p.style.top = y + "%";
            p.style.boxShadow = `0 0 10px ${color}`;
            
            let angle = Math.random() * 6.28;
            let speed = 20 + Math.random() * 40;
            let tx = Math.cos(angle) * speed;
            let ty = Math.sin(angle) * speed;

            p.animate([
                { transform: 'translate(0,0) scale(1)', opacity: 1 },
                { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }
            ], { duration: 600, easing: 'ease-out' });

            layer.appendChild(p);
            setTimeout(() => p.remove(), 600);
        }
    }

    function loop() {
        if (!juegoActivo) return;

        // F√≠sica Bal√≥n
        vx += incliX * 0.08; vy += incliY * 0.08;
        vx *= 0.92; vy *= 0.92; // Fricci√≥n
        x += vx * 0.1; y += vy * 0.1;

        // Colisi√≥n Paredes
        if (x<3 || x>97) { vx *= -0.8; x = x<3?3:97; AudioEngine.playTone(100, 'triangle', 0.05); }
        if (y<3 || y>97) { vy *= -0.8; y = y<3?3:97; AudioEngine.playTone(100, 'triangle', 0.05); }

        // Render Bal√≥n
        rotacionPelota += Math.sqrt(vx*vx + vy*vy) * 5;
        let ball = document.getElementById('pelota');
        ball.style.left = x + "%"; ball.style.top = y + "%";
        ball.style.transform = `translate(-50%,-50%) rotate(${rotacionPelota}deg)`;
        
        // Tilt Tablero
        document.getElementById('tablero').style.transform = `rotateX(${-incliY*0.5}deg) rotateY(${incliX*0.5}deg)`;

        // L√≥gica Entidades
        for (let key in entidades) {
            let ent = entidades[key];
            
            // Mover Entidad
            ent.x += ent.vx; ent.y += ent.vy;
            if (ent.x < 5 || ent.x > 95) ent.vx *= -1;
            if (ent.y < 5 || ent.y > 95) ent.vy *= -1;
            
            ent.el.style.left = ent.x + "%"; ent.el.style.top = ent.y + "%";

            // Reducir cooldown de golpe
            if (ent.cooldown > 0) ent.cooldown--;

            // Colisi√≥n con Bal√≥n
            let dx = x - ent.x; let dy = y - ent.y;
            let dist = Math.sqrt(dx*dx + dy*dy);

            if (dist < 6 && ent.cooldown <= 0) {
                if (ent.data.tipo === 'bueno') {
                    // COSA BUENA
                    puntos += ent.data.valor;
                    AudioEngine.sonidoMoneda();
                    crearExplosion(ent.x, ent.y, '#ffd700');
                    mostrarMensaje("+" + ent.data.valor);
                    
                    // Eliminar
                    ent.el.remove();
                    delete entidades[key];
                    actualizarUI();

                } else {
                    // TARJETA ROJA (Mala)
                    vidas--;
                    AudioEngine.sonidoGolpe();
                    crearExplosion(ent.x, ent.y, '#ff0000');
                    mostrarMensaje("¬°CUIDADO!");
                    
                    actualizarUI();
                    
                    if (vidas <= 0) {
                        gameOver("¬°Tarjeta Roja Expulsado!");
                    } else {
                        // MODIFICACION PEDIDA: Explota y se mueve r√°pido
                        ent.cooldown = 60; // 1 segundo invulnerable para no morir instant√°neo
                        ent.vx *= 3; // Aumentar velocidad X
                        ent.vy *= 3; // Aumentar velocidad Y
                        ent.el.style.fontSize = "55px"; // Se hace m√°s grande
                        ent.el.classList.add('roja-furiosa'); // A√±adir efecto visual
                        
                        // Empuje al bal√≥n al chocar
                        vx = -vx * 2;
                        vy = -vy * 2;
                    }
                }
            }
        }

        // Colisi√≥n Hoyos
        let hoyos = document.querySelectorAll('.hoyo');
        hoyos.forEach(h => {
            let rect = h.getBoundingClientRect();
            let tabRect = document.getElementById('tablero').getBoundingClientRect();
            let hx = ((rect.left + rect.width/2 - tabRect.left) / tabRect.width)*100;
            let hy = ((rect.top + rect.height/2 - tabRect.top) / tabRect.height)*100;
            
            if (Math.sqrt(Math.pow(x-hx,2) + Math.pow(y-hy,2)) < 5) {
                gameOver("Ca√≠ste al vac√≠o");
            }
        });

        requestAnimationFrame(loop);
    }

    function actualizarUI() {
        document.getElementById('puntos-ui').innerText = puntos;
        let vidaStr = "";
        for(let i=0; i<vidas; i++) vidaStr += "‚ù§Ô∏è";
        document.getElementById('vidas-ui').innerText = vidaStr;
    }

    function mostrarMensaje(txt) {
        let d = document.getElementById('dialogo');
        d.innerText = txt;
        d.style.transform = "scale(1.2)";
        setTimeout(() => d.style.transform = "scale(1)", 200);
    }

    function contarTiempo() {
        if (!juegoActivo) return;
        segundos--;
        document.getElementById('timer-ui').innerText = segundos;
        if (segundos <= 0) gameOver("¬°Tiempo Fuera!");
        else setTimeout(contarTiempo, 1000);
    }

    function gameOver(razon) {
        juegoActivo = false;
        AudioEngine.sonidoGameOver();
        setTimeout(() => {
            alert(razon + "\nPuntos: " + puntos);
            document.getElementById('intro').style.display = 'flex';
        }, 500);
    }
</script>
</body>
</html>
