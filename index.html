<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Â¡Mesero Loco Pro!</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #121212; font-family: 'Arial Rounded MT Bold', sans-serif; color: white; text-align: center; }
        #ui { position: absolute; width: 100%; top: 15px; z-index: 10; pointer-events: none; }
        
        #escenario {
            width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center;
        }

        #charola {
            width: 85vw; height: 85vw; background: radial-gradient(circle, #555, #222);
            border: 10px solid #ffd700; border-radius: 50%; position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8); transition: width 0.5s, height 0.5s;
        }

        .agujero {
            width: 55px; height: 55px; background: #000; border: 3px dashed #ff4757;
            border-radius: 50%; position: absolute; transform: translate(-50%, -50%);
            box-shadow: inset 0 0 20px #ff4757;
        }

        #pelota {
            width: 45px; height: 45px; position: absolute; 
            transform: translate(-50%, -50%); font-size: 38px;
            display: flex; align-items: center; justify-content: center;
            z-index: 5;
        }

        .btn { padding: 20px 40px; font-size: 1.5rem; background: #ffd700; color: #000; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; }
        #overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; padding: 20px; box-sizing: border-box; }
        #timer { font-size: 3rem; color: #2ecc71; text-shadow: 0 0 10px #2ecc71; }
    </style>
</head>
<body>

<div id="overlay">
    <h1 id="titulo-overlay">Â¿LISTO PARA EL SHOW?</h1>
    <p id="subtitulo-overlay">SostÃ©n recto el celular. Â¡No seas un manos de mantequilla!</p>
    <button class="btn" onclick="activar()">Â¡DALE!</button>
</div>

<div id="ui">
    <div id="timer"><span id="segundos">10</span>s</div>
    <div id="lvl-txt" style="font-size: 1.4rem; color: #ffd700;">NIVEL 1: Novato</div>
    <div id="status-msg" style="font-style: italic; margin-top: 5px; color: #ccc;">Â¡Vas bien, vas bien!</div>
</div>

<div id="escenario">
    <div id="charola">
        <div id="agujeros-container"></div>
        <div id="pelota">ðŸŽ¾</div>
    </div>
</div>

<script>
    let x = 50, y = 20, vx = 0, vy = 0, incliX = 0, incliY = 0;
    let activo = false, nivel = 0, tiempo = 10;

    const frasesPerder = [
        "Â¡Me recargo en la pared, perdiste!",
        "Â¡Me quiero volver chango!",
        "Â¡Casi casi! AsÃ­ no vas, vas... Â¡Animo para la otra!",
        "Â¡QuÃ© bÃ¡rbaro! Tienes manos de mantequilla.",
        "Â¡Esa pelota tenÃ­a ganas de irse al hoyo!"
    ];

    const frasesGanar = [
        "Â¡AquÃ­ tenemos a un ganador!",
        "Â¡Vean quÃ© bonito es ganar!",
        "Â¡Eso es tener estilo, mesero de lujo!",
        "Â¡Pasaste de milagro, eh!",
        "Â¡Tiembla el mundo, tenemos un experto!"
    ];

    const niveles = [
        { art: "ðŸŽ¾", nom: "Novato", dif: 0.6, t: 10, size: 85, agujeros: [{x:50, y:50}] },
        { art: "âš½", nom: "Aceptable", dif: 0.8, t: 12, size: 80, agujeros: [{x:50, y:50}] },
        { art: "ðŸ€", nom: "Casi Pro", dif: 1.0, t: 15, size: 75, agujeros: [{x:50, y:50}] },
        { art: "ðŸŽ±", nom: "El Billarista", dif: 1.3, t: 15, size: 70, agujeros: [{x:50, y:50}] },
        { art: "ðŸ’£", nom: "Peligro", dif: 1.5, t: 20, size: 65, agujeros: [{x:35, y:35}, {x:65, y:65}] },
        { art: "ðŸ‹", nom: "Limonada", dif: 1.8, t: 20, size: 60, agujeros: [{x:50, y:30}, {x:50, y:70}] },
        { art: "ðŸ’Ž", nom: "Joyas Reales", dif: 2.2, t: 25, size: 55, agujeros: [{x:30, y:50}, {x:70, y:50}, {x:50, y:50}] }
    ];

    function hablar(lista) {
        window.speechSynthesis.cancel();
        const frase = lista[Math.floor(Math.random() * lista.length)];
        let m = new SpeechSynthesisUtterance(frase);
        m.lang = 'es-MX';
        window.speechSynthesis.speak(m);
        if(activo) document.getElementById('status-msg').innerText = frase;
    }

    async function activar() {
        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            const permission = await DeviceOrientationEvent.requestPermission();
            if (permission === 'granted') iniciar();
        } else { iniciar(); }
    }

    function iniciar() {
        document.getElementById('overlay').style.display = 'none';
        activo = true;
        window.addEventListener('deviceorientation', (e) => {
            incliX = e.gamma; 
            incliY = e.beta;
        });
        actualizarNivelVisual();
        correrTiempo();
        update();
    }

    function actualizarNivelVisual() {
        const n = niveles[nivel];
        const char = document.getElementById('charola');
        const agCont = document.getElementById('agujeros-container');
        
        char.style.width = n.size + "vw";
        char.style.height = n.size + "vw";
        document.getElementById('pelota').innerText = n.art;
        document.getElementById('lvl-txt').innerText = `NIVEL ${nivel+1}: ${n.nom}`;
        
        agCont.innerHTML = '';
        n.agujeros.forEach(pos => {
            let div = document.createElement('div');
            div.className = 'agujero';
            div.style.left = pos.x + "%";
            div.style.top = pos.y + "%";
            agCont.appendChild(div);
        });
    }

    function correrTiempo() {
        if (!activo) return;
        if (tiempo <= 0) {
            pasarNivel();
        } else {
            document.getElementById('segundos').innerText = tiempo;
            tiempo--;
            if (tiempo % 4 === 0) document.getElementById('status-msg').innerText = "Â¡Sigue, no te detengas!";
            setTimeout(correrTiempo, 1000);
        }
    }

    function pasarNivel() {
        activo = false;
        nivel++;
        if (nivel < niveles.length) {
            hablar(frasesGanar);
            document.getElementById('titulo-overlay').innerText = "Â¡NIVEL SUPERADO!";
            document.getElementById('subtitulo-overlay').innerText = "PrepÃ¡rate para lo que viene...";
            document.getElementById('overlay').style.display = 'flex';
            tiempo = niveles[nivel].t;
            x = 50; y = 15; vx = 0; vy = 0;
        } else {
            hablar(["Â¡ERES EL REY DE LOS MESEROS!"]);
            alert("Â¡GANASTE TODO!");
            location.reload();
        }
    }

    function update() {
        if (!activo) return;

        let d = niveles[nivel].dif;
        vx += incliX * 0.04 * d;
        vy += incliY * 0.04 * d;
        vx *= 0.94; 
        vy *= 0.94;
        x += vx;
        y += vy;

        const p = document.getElementById('pelota');
        p.style.left = x + "%";
        p.style.top = y + "%";

        let dx = x - 50, dy = y - 50;
        let distCentro = Math.sqrt(dx*dx + dy*dy);

        // ColisiÃ³n con agujeros
        niveles[nivel].agujeros.forEach(h => {
            let hdx = x - h.x, hdy = y - h.y;
            if(Math.sqrt(hdx*hdx + hdy*hdy) < 7) perder();
        });

        // ColisiÃ³n con bordes (Rebote realista)
        if (distCentro > 44) {
             vx *= -0.8; // Rebota hacia adentro
             vy *= -0.8;
             x += vx * 2;
             y += vy * 2;
             if(distCentro > 48) perder(); // Si se sale demasiado, muere
        }

        if (activo) requestAnimationFrame(update);
    }

    function perder() {
        activo = false;
        hablar(frasesPerder);
        setTimeout(() => {
            alert("Â¡GAME OVER!");
            location.reload();
        }, 1500);
    }
</script>
</body>
</html>
