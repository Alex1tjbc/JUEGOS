<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Striker: Power-Ups</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg-color: #121212;
            --neon-azul: #00f3ff;
            --neon-rojo: #ff0055;
            --neon-verde: #00ff66;
            --neon-amarillo: #ffdd00;
            --neon-morado: #bc13fe;
        }
        body { 
            margin: 0; padding: 0; overflow: hidden; 
            background: #050505; 
            font-family: 'Orbitron', sans-serif;
            touch-action: none; user-select: none;
        }
        
        #ui-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: 80px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex; justify-content: space-around; align-items: center;
            z-index: 100; color: white; font-weight: bold;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }
        .stat-box { text-align: center; text-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .stat-val { font-size: 1.5rem; margin-top: 5px; }
        #vidas-val { letter-spacing: 2px; }

        #game-area {
            position: absolute; top: 0; left: 0; width: 100vw; height: 100vh;
            display: flex; align-items: center; justify-content: center;
            perspective: 1000px; overflow: hidden;
        }

        #tablero {
            width: 90vw; height: 130vw; max-height: 85vh; max-width: 60vh; 
            background: radial-gradient(circle at center, #1a1a2e 0%, #000 90%);
            border: 4px solid var(--neon-azul);
            box-shadow: 0 0 30px var(--neon-azul), inset 0 0 80px rgba(0,0,0,0.8);
            border-radius: 15px; position: relative;
            transform-style: preserve-3d; overflow: hidden;
            transition: box-shadow 0.3s, border-color 0.3s;
        }
        
        #tablero::after {
            content: ''; position: absolute; top:-50%; left:-50%; width:200%; height:200%;
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px; z-index: 0; pointer-events: none;
            transform: perspective(500px) rotateX(60deg);
            animation: moverSuelo 1s linear infinite;
        }
        @keyframes moverSuelo { from { background-position: 0 0; } to { background-position: 0 50px; } }

        /* --- ESTILOS DEL BAL√ìN Y ESCUDO --- */
        #pelota {
            width: 40px; height: 40px; position: absolute;
            background: radial-gradient(circle at 30% 30%, #fff 0%, #ddd 20%, #111 100%);
            border-radius: 50%; z-index: 20;
            box-shadow: 0 0 15px var(--neon-azul);
            transform: translate(-50%, -50%);
            transition: box-shadow 0.3s, border 0.3s;
        }
        
        /* ESTADO ESCUDO ACTIVO */
        .con-escudo {
            box-shadow: 0 0 20px 5px var(--neon-azul), inset 0 0 10px var(--neon-azul) !important;
            border: 3px solid #fff;
            background: radial-gradient(circle at 30% 30%, #aaffff 0%, #0088ff 100%) !important;
        }
        .con-escudo::after {
            content: ''; position: absolute; top: -10px; left: -10px; right: -10px; bottom: -10px;
            border: 2px dashed #fff; border-radius: 50%;
            animation: rotarEscudo 2s linear infinite;
        }
        @keyframes rotarEscudo { 100% { transform: rotate(360deg); } }

        /* ITEMS ESPECIALES */
        .elemento {
            position: absolute; transform: translate(-50%, -50%);
            z-index: 10; font-size: 38px;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.4));
            transition: all 0.3s;
        }

        .vida-temporal {
            animation: latido 1s infinite;
        }
        @keyframes latido { 0%, 100% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.2); } }

        .roja-caos {
            filter: drop-shadow(0 0 15px red) hue-rotate(30deg) !important;
        }

        .hoyo {
            position: absolute; width: 65px; height: 65px;
            background: black; border-radius: 50%;
            border: 2px solid var(--neon-rojo);
            box-shadow: inset 0 0 20px #000, 0 0 10px var(--neon-rojo);
            transform: translate(-50%, -50%); z-index: 5;
        }
        .hoyo::before { content: '‚ò†Ô∏è'; position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size: 22px; opacity: 0.7; }

        /* Notificaciones flotantes */
        .float-text {
            position: absolute; font-size: 1.2rem; font-weight: bold; color: white;
            pointer-events: none; z-index: 50; text-shadow: 0 0 5px black;
            animation: floatUp 1s forwards;
        }
        @keyframes floatUp { to { transform: translateY(-50px); opacity: 0; } }

        .particula { position: absolute; width: 8px; height: 8px; border-radius: 50%; pointer-events: none; z-index: 30; }

        .overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            color: white; z-index: 200;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center;
        }
        .btn {
            background: transparent; color: var(--neon-verde);
            padding: 15px 50px; font-size: 22px; font-weight: 900;
            border: 3px solid var(--neon-verde); border-radius: 50px; margin-top: 30px;
            cursor: pointer; box-shadow: 0 0 15px var(--neon-verde);
            font-family: 'Orbitron', sans-serif;
        }
        .hidden { display: none !important; }

        /* Animaci√≥n Temblor */
        .temblor { animation: shakeScreen 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shakeScreen {
            10%, 90% { transform: translate3d(-4px, 0, 0); }
            20%, 80% { transform: translate3d(6px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-8px, 0, 0); }
            40%, 60% { transform: translate3d(8px, 0, 0); }
        }

    </style>
</head>
<body>

<div id="ui-bar">
    <div class="stat-box"><div style="color:var(--neon-rojo); font-size:0.8rem;">VIDAS</div><div id="vidas-val" class="stat-val">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div></div>
    <div class="stat-box"><div style="color:var(--neon-azul); font-size:0.8rem;">TIEMPO</div><div id="tiempo-val" class="stat-val">60</div></div>
    <div class="stat-box"><div style="color:var(--neon-amarillo); font-size:0.8rem;">SCORE</div><div id="puntos-val" class="stat-val">0</div></div>
</div>

<div id="game-area">
    <div id="tablero">
        <div id="capa-hoyos"></div>
        <div id="capa-items"></div>
        <div id="capa-fx"></div>
        <div id="pelota"></div>
    </div>
</div>

<div id="pantalla-inicio" class="overlay">
    <h1 style="color:var(--neon-azul); font-size: 3rem; margin:0;">NEON STRIKER</h1>
    <h3 style="color:#fff;">POWER-UPS EDITION</h3>
    <div style="text-align:left; padding:20px; line-height: 1.6; background: rgba(255,255,255,0.05); border-radius: 15px; margin-top:10px; font-size: 0.9rem;">
        üõ°Ô∏è <strong>Escudo:</strong> Inmortalidad (6s)<br>
        üí£ <strong>Bomba:</strong> ¬°Acelera las rojas!<br>
        ü¶π <strong>Ladr√≥n:</strong> Roba puntos<br>
        üíñ <strong>Vida:</strong> Recup√©rate (dura 6s)
    </div>
    <button class="btn" onclick="iniciarJuego()">JUGAR</button>
</div>

<div id="pantalla-fin" class="overlay hidden">
    <h1 style="color:var(--neon-rojo); font-size: 3rem;">GAME OVER</h1>
    <p style="font-size:2rem;">SCORE: <span id="score-final" style="color:var(--neon-amarillo)">0</span></p>
    <button class="btn" onclick="location.reload()">REINTENTAR</button>
</div>

<script>
    const config = { velocidad: 0.15, friccion: 0.94, radioColision: 6, radioHoyo: 4 };

    let estado = {
        jugando: false, x: 50, y: 50, vx: 0, vy: 0,
        incliX: 0, incliY: 0, puntos: 0, vidas: 3, tiempo: 60, rotacion: 0,
        escudoActivo: false
    };

    let items = []; let hoyos = []; 

    // --- AUDIO ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function beep(f, t, d) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
        o.type = t; o.frequency.value = f;
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); g.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + d);
        o.stop(audioCtx.currentTime + d);
    }
    const sfx = {
        bien: () => beep(1000, 'sine', 0.1),
        mal: () => beep(150, 'sawtooth', 0.2),
        escudo: () => { beep(400, 'square', 0.1); setTimeout(()=>beep(600,'square',0.3), 100); },
        bomba: () => beep(100, 'sawtooth', 0.5),
        vida: () => { beep(800, 'sine', 0.1); setTimeout(()=>beep(1200,'sine',0.2), 100); }
    };

    function iniciarJuego() {
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission().then(res => { if (res === 'granted') arrancar(); }).catch(arrancar);
        } else { arrancar(); }
    }

    function arrancar() {
        document.getElementById('pantalla-inicio').classList.add('hidden');
        estado.jugando = true;
        window.addEventListener('deviceorientation', e => {
            estado.incliX = Math.min(30, Math.max(-30, e.gamma || 0)); 
            estado.incliY = Math.min(30, Math.max(-30, e.beta || 0));
        });
        window.addEventListener('keydown', e => {
            if(e.key === 'ArrowRight') estado.incliX = 20; if(e.key === 'ArrowLeft') estado.incliX = -20;
            if(e.key === 'ArrowUp') estado.incliY = -20; if(e.key === 'ArrowDown') estado.incliY = 20;
            setTimeout(() => { if(e.key.includes('Arrow')) { estado.incliX=0; estado.incliY=0; } }, 300);
        });

        crearHoyosSeguros();
        requestAnimationFrame(gameLoop);
        setInterval(spawnItem, 1200);
        setInterval(reloj, 1000);
    }

    function crearHoyosSeguros() {
        const div = document.getElementById('capa-hoyos'); div.innerHTML = '';
        hoyos = [{x: 20, y: 20}, {x: 80, y: 20}, {x: 20, y: 80}, {x: 80, y: 80}];
        hoyos.forEach(h => {
            let el = document.createElement('div'); el.className = 'hoyo';
            el.style.left = h.x + '%'; el.style.top = h.y + '%';
            div.appendChild(el);
        });
    }

    function spawnItem() {
        if(!estado.jugando) return;
        
        // Tabla de Probabilidades
        // type: ok (puntos), bad (roja), shield (escudo), thief (ladr√≥n), boom (bomba), life (vida)
        const tabla = [
            {emoji:'üòÄ', type:'ok', val:10, speed:0.3},
            {emoji:'üòÄ', type:'ok', val:10, speed:0.3},
            {emoji:'üèÜ', type:'ok', val:50, speed:0.8},
            {emoji:'üü•', type:'bad', val:-1, speed:0.6},
            {emoji:'üü•', type:'bad', val:-1, speed:0.6},
            {emoji:'üõ°Ô∏è', type:'shield', val:0, speed:0.2}, // Escudo
            {emoji:'ü¶π', type:'thief', val:-100, speed:0.5}, // Ladr√≥n
            {emoji:'üí£', type:'boom', val:0, speed:0.4},   // Bomba
            {emoji:'üíñ', type:'life', val:1, speed:0.9}    // Vida
        ];
        
        const ele = tabla[Math.floor(Math.random() * tabla.length)];
        let nx, ny;
        do { nx = 10 + Math.random() * 80; ny = 10 + Math.random() * 80; } 
        while (Math.abs(nx - 50) < 15 && Math.abs(ny - 50) < 15);

        let div = document.createElement('div'); div.className = 'elemento';
        div.innerText = ele.emoji; div.style.left = nx + '%'; div.style.top = ny + '%';
        if(ele.type === 'bad') div.style.textShadow = "0 0 10px red";
        if(ele.type === 'life') div.classList.add('vida-temporal');
        
        document.getElementById('capa-items').appendChild(div);

        // Crear objeto item
        let newItem = {
            el: div, x: nx, y: ny, vx: (Math.random()-0.5)*ele.speed, vy: (Math.random()-0.5)*ele.speed,
            tipo: ele.type, val: ele.val, 
            creado: Date.now() // Para controlar tiempo de vida
        };
        items.push(newItem);
    }

    function mostrarTexto(txt, x, y, color) {
        let t = document.createElement('div'); t.className = 'float-text';
        t.innerText = txt; t.style.color = color;
        t.style.left = x + '%'; t.style.top = y + '%';
        document.getElementById('capa-fx').appendChild(t);
        setTimeout(() => t.remove(), 1000);
    }

    function activarEscudo() {
        if(estado.escudoActivo) return; // Ya activo
        estado.escudoActivo = true;
        document.getElementById('pelota').classList.add('con-escudo');
        sfx.escudo();
        mostrarTexto("¬°ESCUDO!", 50, 50, "#00f3ff");
        
        setTimeout(() => {
            estado.escudoActivo = false;
            document.getElementById('pelota').classList.remove('con-escudo');
        }, 6000);
    }

    function activarBomba() {
        document.body.classList.add('temblor');
        setTimeout(() => document.body.classList.remove('temblor'), 500);
        crearExplosion(50, 50, '#ffaa00');
        sfx.bomba();
        mostrarTexto("¬°CAOS!", 50, 50, "orange");

        // Acelerar todas las rojas por 6 segundos
        items.forEach(it => {
            if(it.tipo === 'bad') {
                it.vx *= 3; it.vy *= 3; // Acelerar
                it.el.classList.add('roja-caos'); // Efecto visual
                setTimeout(() => {
                    // Intentar revertir (si sigue viva)
                    it.vx /= 3; it.vy /= 3;
                    if(it.el) it.el.classList.remove('roja-caos');
                }, 6000);
            }
        });
    }

    function gameLoop() {
        if(!estado.jugando) return;

        // F√≠sica
        estado.vx += estado.incliX * 0.005; estado.vy += estado.incliY * 0.005;
        estado.vx *= config.friccion; estado.vy *= config.friccion;
        estado.x += estado.vx; estado.y += estado.vy;

        if(estado.x <= 2 || estado.x >= 98) { estado.vx *= -0.6; estado.x = estado.x < 2 ? 2 : 98; }
        if(estado.y <= 2 || estado.y >= 98) { estado.vy *= -0.6; estado.y = estado.y < 2 ? 2 : 98; }

        estado.rotacion += Math.sqrt(estado.vx*estado.vx + estado.vy*estado.vy) * 10;
        const bola = document.getElementById('pelota');
        bola.style.left = estado.x + '%'; bola.style.top = estado.y + '%';
        bola.style.transform = `translate(-50%, -50%) rotate(${estado.rotacion}deg)`;
        
        document.getElementById('tablero').style.transform = `rotateX(${-estado.incliY * 0.5}deg) rotateY(${estado.incliX * 0.5}deg)`;

        // Colisi√≥n Hoyos
        for(let h of hoyos) {
            let dist = Math.sqrt(Math.pow(estado.x - h.x, 2) + Math.pow(estado.y - h.y, 2));
            // SI TIENE ESCUDO, IGNORA EL HOYO
            if(dist < config.radioHoyo && !estado.escudoActivo) { 
                gameOver("¬°CA√çSTE AL VAC√çO!"); return; 
            }
        }

        // L√≥gica Items
        let tiempoActual = Date.now();
        for (let i = items.length - 1; i >= 0; i--) {
            let it = items[i];
            
            // CADUCIDAD DE LA VIDA (6 SEGUNDOS)
            if(it.tipo === 'life' && (tiempoActual - it.creado > 6000)) {
                it.el.remove(); items.splice(i, 1);
                continue;
            }

            // Movimiento
            it.x += it.vx; it.y += it.vy;
            if(it.x < 5 || it.x > 95) it.vx *= -1;
            if(it.y < 5 || it.y > 95) it.vy *= -1;
            it.el.style.left = it.x + '%'; it.el.style.top = it.y + '%';

            let dist = Math.sqrt(Math.pow(estado.x - it.x, 2) + Math.pow(estado.y - it.y, 2));

            if(dist < config.radioColision) {
                // COLISI√ìN DETECTADA
                let eliminar = true;

                if(it.tipo === 'ok') {
                    estado.puntos += it.val;
                    crearExplosion(it.x, it.y, '#ffdd00');
                    mostrarTexto("+"+it.val, it.x, it.y, "#ffdd00");
                    sfx.bien();
                
                } else if(it.tipo === 'shield') {
                    activarEscudo();
                    crearExplosion(it.x, it.y, '#00f3ff');
                
                } else if(it.tipo === 'boom') {
                    activarBomba();
                
                } else if(it.tipo === 'thief') {
                    estado.puntos += it.val; // Es negativo (-100)
                    mostrarTexto("-100", it.x, it.y, "#aa0000");
                    crearExplosion(it.x, it.y, '#555');
                    sfx.mal();

                } else if(it.tipo === 'life') {
                    if(estado.vidas < 3) {
                        estado.vidas++;
                        mostrarTexto("+1 ‚ù§Ô∏è", it.x, it.y, "#ff0055");
                        crearExplosion(it.x, it.y, '#ff0055');
                        sfx.vida();
                    } else {
                        mostrarTexto("FULL", it.x, it.y, "#fff");
                    }

                } else if(it.tipo === 'bad') {
                    // SI TIENE ESCUDO, NO PASA NADA
                    if(estado.escudoActivo) {
                        mostrarTexto("BLOCKED", it.x, it.y, "#fff");
                        // Rebote simple
                        estado.vx *= -1; estado.vy *= -1;
                        eliminar = false; // No eliminar la tarjeta roja
                    } else {
                        // Da√±o normal
                        estado.vidas--;
                        crearExplosion(it.x, it.y, '#ff0000');
                        document.body.classList.add('temblor');
                        setTimeout(() => document.body.classList.remove('temblor'), 500);
                        sfx.mal();
                        
                        if(estado.vidas <= 0) { gameOver("ELIMINADO"); return; }
                        
                        // Empuje
                        estado.vx = -estado.vx * 2; estado.vy = -estado.vy * 2;
                        it.vx *= -1; it.vy *= -1;
                        it.x = (it.x + 50) % 100; // Alejarla un poco
                        eliminar = false; // La roja se queda
                    }
                }

                if(eliminar) {
                    it.el.remove(); items.splice(i, 1);
                }
                actualizarHUD();
            }
        }
        requestAnimationFrame(gameLoop);
    }

    function crearExplosion(x, y, color) {
        const capa = document.getElementById('capa-fx');
        for(let k=0; k<8; k++) {
            let p = document.createElement('div'); p.className = 'particula';
            p.style.backgroundColor = color; p.style.left = x + '%'; p.style.top = y + '%';
            let angle = Math.random() * 6.28; let speed = 20 + Math.random() * 30;
            let tx = Math.cos(angle) * speed; let ty = Math.sin(angle) * speed;
            p.animate([{ transform: 'translate(0,0) scale(1)', opacity: 1 }, { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }], { duration: 500 });
            capa.appendChild(p); setTimeout(() => p.remove(), 500);
        }
    }

    function actualizarHUD() {
        document.getElementById('puntos-val').innerText = estado.puntos;
        let c = ""; for(let i=0; i<estado.vidas; i++) c += "‚ù§Ô∏è";
        document.getElementById('vidas-val').innerText = c;
    }

    function reloj() {
        if(!estado.jugando) return;
        estado.tiempo--; document.getElementById('tiempo-val').innerText = estado.tiempo;
        if(estado.tiempo <= 0) gameOver("TIEMPO AGOTADO");
    }

    function gameOver(razon) {
        estado.jugando = false; 
        document.getElementById('pantalla-fin').classList.remove('hidden');
        document.getElementById('score-final').innerText = estado.puntos;
    }
</script>
</body>
</html>
