<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mesero Simpson Challenge</title>
    <style>
        :root { --borde: #3d2b1f; --madera: #6d4c41; }
        body { margin: 0; padding: 0; overflow: hidden; background: #1a1a1a; font-family: 'Comic Sans MS', sans-serif; }
        
        #escenario { width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; perspective: 1000px; }

        #tablero {
            width: 85vw; height: 130vw; background: var(--madera);
            background-image: repeating-linear-gradient(rgba(0,0,0,0.05) 0px, rgba(0,0,0,0.05) 20px, rgba(0,0,0,0.1) 21px);
            border: 20px solid var(--borde); border-radius: 20px;
            position: relative; box-shadow: 0 40px 60px rgba(0,0,0,0.8);
        }

        .hoyo {
            position: absolute; width: 75px; height: 75px; background: #000;
            border-radius: 50%; box-shadow: inset 0 10px 20px #000;
            transform: translate(-50%, -50%);
        }

        #raton {
            position: absolute; font-size: 35px; transform: translate(-50%, -50%);
            z-index: 8; transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #pelota {
            width: 55px; height: 55px; position: absolute; 
            transform: translate(-50%, -50%); font-size: 45px;
            display: flex; align-items: center; justify-content: center;
            z-index: 10; filter: drop-shadow(0 10px 5px rgba(0,0,0,0.5));
        }

        #ui { position: fixed; top: 10px; width: 100%; text-align: center; color: #ffd700; z-index: 100; text-shadow: 2px 2px #000; }
        #timer { font-size: 3rem; margin: 0; }
        .overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 1000; color: white;
        }
        .btn { padding: 20px 50px; font-size: 1.5rem; background: #ffd700; color: #000; border: none; border-radius: 50px; font-weight: bold; }
    </style>
</head>
<body>

<div id="ui">
    <div id="vidas-ui">Vidas: ‚ù§Ô∏è</div>
    <h1 id="timer">15</h1>
    <p id="dialogo" style="background: rgba(0,0,0,0.5); display: inline-block; padding: 5px 15px; border-radius: 10px;"></p>
</div>

<div id="escenario">
    <div id="tablero">
        <div id="agujeros"></div>
        <div id="raton">üê≠</div>
        <div id="pelota">‚öΩ</div>
    </div>
</div>

<div id="intro" class="overlay">
    <h1 style="color:#ffd700">¬°ME QUIERO VOLVER CHANGO!</h1>
    <p>¬°No dejes que la bola caiga al hoyo o no habr√° rosquillas!</p>
    <button class="btn" onclick="iniciar()">¬°A LA DALAI!</button>
</div>

<script>
    let x = 50, y = 20, vx = 0, vy = 0, rot = 0;
    let incliX = 0, incliY = 0, activo = false;
    let nivel = 0, segundos = 15, vidas = 1;
    let ratonX = -10, ratonY = -10;

    const frasesPerder = [
        "¬°D'oh! ¬°Me quiero volver chango!",
        "¬°Me recargo en la pared! ¬°Perd√≠ mis rosquillas!",
        "¬°Est√∫pido y sensual hoyo!",
        "¬°Ouh! ¬°Nadie me quiere!",
        "¬°Peque√±o demonio, me hiciste perder!"
    ];

    const frasesGanar = [
        "¬°A la grande le puse Cuca! ¬°Ganamos!",
        "¬°Vean qu√© bonito es ganar! ¬°Yuju!",
        "¬°Me lo merezco! ¬°Soy un genio!",
        "¬°Mmm... rosquillas de la victoria!"
    ];

    const niveles = [
        { obj: "‚öΩ", t: 15, dif: 0.6, hoyos: [{x:50, y:55}] },
        { obj: "üèÄ", t: 20, dif: 0.8, hoyos: [{x:25, y:25}, {x:75, y:75}] },
        { obj: "üí£", t: 25, dif: 1.1, hoyos: [{x:50, y:20}, {x:50, y:80}, {x:50, y:50}] }
    ];

    function hablar(lista, personalizada = false) {
        window.speechSynthesis.cancel();
        let texto = personalizada ? lista : lista[Math.floor(Math.random() * lista.length)];
        let m = new SpeechSynthesisUtterance(texto);
        
        // --- CONFIGURACI√ìN "HOMERO" ---
        m.lang = 'es-MX'; 
        m.pitch = 0.7; // Voz m√°s grave
        m.rate = 0.85; // Habla m√°s despacio
        // ------------------------------

        window.speechSynthesis.speak(m);
        document.getElementById('dialogo').innerText = texto;
    }

    async function iniciar() {
        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            const res = await DeviceOrientationEvent.requestPermission();
            if (res === 'granted') arrancar();
        } else { arrancar(); }
    }

    function arrancar() {
        document.getElementById('intro').style.display = 'none';
        activo = true;
        window.addEventListener('deviceorientation', e => { 
            incliX = e.gamma; 
            incliY = e.beta; 
        });
        cargarNivel();
        moverRaton(); 
        setInterval(moverRaton, 4000);
        loop();
    }

    function moverRaton() {
        if (!activo) return;
        ratonX = 20 + Math.random() * 60;
        ratonY = 20 + Math.random() * 60;
        const r = document.getElementById('raton');
        r.style.left = ratonX + "%";
        r.style.top = ratonY + "%";
    }

    function cargarNivel() {
        const n = niveles[nivel];
        document.getElementById('pelota').innerText = n.obj;
        segundos = n.t;
        const hCont = document.getElementById('agujeros');
        hCont.innerHTML = '';
        n.hoyos.forEach(h => {
            let div = document.createElement('div'); div.className = 'hoyo';
            div.style.left = h.x + "%"; div.style.top = h.y + "%";
            hCont.appendChild(div);
        });
        hablar("¬°Nivel " + (nivel+1) + ". ¬°Yuju!", true);
        timer();
    }

    function timer() {
        if (!activo) return;
        document.getElementById('timer').innerText = segundos;
        if (segundos <= 0) {
            nivel++;
            if (nivel < niveles.length) { hablar(frasesGanar); cargarNivel(); }
            else { activo = false; hablar("¬°Soy un genio! ¬°Felicidades, ganaste!", true); alert("¬°ERES EL GANADOR!"); location.reload(); }
        } else { segundos--; setTimeout(timer, 1000); }
    }

    function loop() {
        if (!activo) return;
        let d = niveles[nivel].dif;
        vx += incliX * 0.05 * d; vy += incliY * 0.05 * d;
        vx *= 0.94; vy *= 0.94;
        x += vx * 0.2; y += vy * 0.2;
        rot += (vx + vy) * 2;

        const p = document.getElementById('pelota');
        const t = document.getElementById('tablero');
        p.style.left = x + "%"; p.style.top = y + "%";
        p.style.transform = `translate(-50%, -50%) rotate(${rot}deg)`;
        
        // Efecto 3D de inclinaci√≥n
        t.style.transform = `rotateX(${-incliY*0.4}deg) rotateY(${incliX*0.4}deg)`;

        // Colisi√≥n Rat√≥n
        let distRaton = Math.sqrt(Math.pow(x - ratonX, 2) + Math.pow(y - ratonY, 2));
        if (distRaton < 6) {
            vidas++; ratonX = -100;
            hablar("¬°M√≠renme! ¬°Tengo una vida extra!", true);
            actualizarVidas();
        }

        // Colisi√≥n Hoyos
        niveles[nivel].hoyos.forEach(h => {
            if (Math.sqrt(Math.pow(x - h.x, 2) + Math.pow(y - h.y, 2)) < 6) morir();
        });

        // Colisi√≥n Bordes
        if (x < 5 || x > 95 || y < 5 || y > 95) morir();

        requestAnimationFrame(loop);
    }

    function actualizarVidas() {
        document.getElementById('vidas-ui').innerText = "Vidas: " + "‚ù§Ô∏è".repeat(vidas);
    }

    function morir() {
        if (vidas > 1) {
            vidas--; actualizarVidas();
            x = 50; y = 15; vx = 0; vy = 0;
            hablar("¬°Me salv√© por un pelito de rana calva!", true);
        } else {
            activo = false; 
            hablar(frasesPerder);
            setTimeout(() => location.reload(), 3000);
        }
    }
</script>
</body>
</html>
