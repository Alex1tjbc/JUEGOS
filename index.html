<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cazador de Personajes: Edici√≥n F√∫tbol</title>
    <style>
        :root { 
            --borde-dorado: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%);
            /* Cancha de hielo/futurista */
            --hielo: radial-gradient(circle at 50% 50%, #ffffff 0%, #e3f2fd 60%, #bbdefb 100%); 
            --agujero-vortex: radial-gradient(circle, #1a0033 0%, #000000 70%);
            --fondo-oscuro: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);
        }
        body { 
            margin: 0; padding: 0; overflow: hidden; 
            background: var(--fondo-oscuro); 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            perspective: 1500px;
            touch-action: none; /* Previene scroll en m√≥viles */
        }
        
        #escenario { width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }

        #tablero {
            width: 90vw; height: 130vw; 
            background: var(--hielo);
            /* Textura sutil para el piso */
            background-image: 
                linear-gradient(rgba(0,168,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,168,255,0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            border: 15px solid #fff; 
            outline: 5px solid #000;
            border-radius: 30px; 
            position: relative;
            box-shadow: 
                0 50px 100px rgba(0,0,0,0.9),
                inset 0 0 60px rgba(0,0,0,0.2);
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }

        /* Dise√±o de los hoyos (Trampas) */
        .hoyo {
            position: absolute; 
            width: 65px; 
            height: 65px; 
            background: var(--agujero-vortex);
            border-radius: 50%; 
            border: 2px solid rgba(255,255,255,0.1);
            box-shadow: inset 0 10px 20px #000;
            transform: translate(-50%, -50%);
            z-index: 1;
        }

        .personaje {
            position: absolute; 
            font-size: 42px; 
            transform: translate(-50%, -50%);
            z-index: 8; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3));
            animation: flotar 2s ease-in-out infinite;
        }
        @keyframes flotar {
            0%, 100% { transform: translate(-50%, -50%) translateY(0px); }
            50% { transform: translate(-50%, -50%) translateY(-5px); }
        }

        /* --- DISE√ëO DEL BAL√ìN DE F√öTBOL REALISTA --- */
        #pelota {
            width: 50px; 
            height: 50px; 
            position: absolute; 
            /* Fondo blanco base */
            background-color: #fdfdfd;
            
            /* Patr√≥n SVG de hex√°gonos para simular el bal√≥n */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50 0 L65 25 L35 25 Z' fill='black'/%3E%3Cpath d='M50 100 L65 75 L35 75 Z' fill='black'/%3E%3Cpath d='M0 50 L25 35 L25 65 Z' fill='black'/%3E%3Cpath d='M100 50 L75 35 L75 65 Z' fill='black'/%3E%3Cpath d='M50 50 L62 58 L50 70 L38 58 Z' fill='black' opacity='0.8'/%3E%3Ccircle cx='50' cy='50' r='12' fill='black'/%3E%3C/svg%3E");
            background-size: cover;
            
            border-radius: 50%;
            z-index: 10; 
            
            /* Sombreado interno para dar efecto 3D esf√©rico */
            box-shadow: 
                inset -5px -5px 15px rgba(0,0,0,0.3),
                inset 5px 5px 15px rgba(255,255,255,0.8),
                0 10px 15px rgba(0,0,0,0.4); /* Sombra proyectada en el piso */

            /* Centrado inicial */
            transform: translate(-50%, -50%);
            
            /* La rotaci√≥n se controlar√° por JS, pero a√±adimos will-change para rendimiento */
            will-change: transform, left, top;
        }

        #ui { 
            position: fixed; 
            top: 15px; 
            width: 100%; 
            text-align: center; 
            color: white; 
            z-index: 100; 
            pointer-events: none;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8); 
        }
        #puntos-ui { 
            font-size: 2rem; 
            font-weight: 800; 
            color: #ffeb3b; 
        }
        #timer-ui { 
            font-size: 3rem; 
            font-weight: 900; 
            margin: 5px 0; 
            color: #fff; 
        }
        #dialogo { 
            font-size: 1.1rem; 
            background: rgba(0,0,0,0.6); 
            padding: 8px 15px; 
            border-radius: 20px; 
            display: inline-block; 
            backdrop-filter: blur(5px);
        }
        
        .overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.92);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 1000; color: white;
        }
        .btn { 
            padding: 20px 50px; 
            font-size: 1.5rem; 
            background: white; 
            color: #000; 
            border: none; 
            border-radius: 50px; 
            font-weight: bold; 
            cursor: pointer; 
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }
    </style>
</head>
<body>

<div id="ui">
    <div id="puntos-ui">GOLES: <span id="puntos">0</span></div>
    <div id="timer-ui"><span id="segundos">60</span></div>
    <p id="dialogo">¬°Mueve el celular para rodar!</p>
</div>

<div id="escenario">
    <div id="tablero">
        <div id="agujeros-container"></div>
        <div id="personajes-container"></div>
        <div id="pelota"></div>
    </div>
</div>

<div id="intro" class="overlay">
    <h1 style="font-size:2.5rem; margin-bottom:10px;">‚öΩ FUTBOLITO EXTREMO</h1>
    <p style="text-align:center; padding:0 30px; line-height:1.5;">
        Inclina tu dispositivo para hacer <strong>RODAR EL BAL√ìN</strong>.<br><br>
        üòÄ Aficionados (+10) <br>
        üòé VIPs (+20) <br>
        üèÜ Copas (+50) <br>
        üü• Tarjeta Roja (-30) <br><br>
        ¬°No caigas en los agujeros negros!
    </p>
    <button class="btn" onclick="iniciarJuego()">¬°SAQUE INICIAL!</button>
</div>

<script>
    let x = 50, y = 50, vx = 0, vy = 0;
    let incliX = 0, incliY = 0, juegoActivo = false;
    let puntos = 0, segundos = 60;
    
    // Variable para acumular la rotaci√≥n del bal√≥n
    let rotacionAcumulada = 0;

    const tiposPersonajes = [
        { emoji: "üòÄ", valor: 10, prob: 0.4, speed: 0.5 },
        { emoji: "üòé", valor: 20, prob: 0.3, speed: 0.8 },
        { emoji: "üèÜ", valor: 50, prob: 0.1, speed: 1.2 }, // Cambiado a Copa
        { emoji: "üü•", valor: -30, prob: 0.2, speed: 0.9 } // Cambiado a Tarjeta Roja
    ];

    let personajesEnJuego = {};

    const frasesPositivas = ["¬°Golazo!", "¬°Buena jugada!", "¬°Sigue as√≠!", "¬°Crack!"];
    const frasesNegativas = ["¬°Falta!", "¬°Fuera de lugar!", "¬°Cuidado √°rbitro!"];

    function hablar(texto) {
        // Simple visual feedback en lugar de voz para rendimiento r√°pido
        document.getElementById('dialogo').innerText = texto;
    }

    async function iniciarJuego() {
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            try {
                const res = await DeviceOrientationEvent.requestPermission();
                if (res === 'granted') arrancarJuego();
                else alert("Necesitas dar permiso de orientaci√≥n para jugar.");
            } catch (e) { arrancarJuego(); }
        } else { arrancarJuego(); }
    }

    function arrancarJuego() {
        document.getElementById('intro').style.display = 'none';
        juegoActivo = true;
        // Reiniciar posici√≥n
        x = 50; y = 50; vx = 0; vy = 0;
        
        window.addEventListener('deviceorientation', manejarOrientacion);
        
        generarAgujeros();
        setInterval(spawnPersonaje, 1500); // M√°s r√°pido
        contarTiempo();
        gameLoop();
    }

    function manejarOrientacion(e) {
        // Ajuste para mayor sensibilidad y control
        incliX = e.gamma || 0; 
        incliY = e.beta || 0; 
        
        // Limitar inclinaci√≥n para que no se "vuelva loco" al ponerlo vertical
        if (incliX > 45) incliX = 45;
        if (incliX < -45) incliX = -45;
        if (incliY > 45) incliY = 45;
        if (incliY < -45) incliY = -45;
    }

    function generarAgujeros() {
        const agCont = document.getElementById('agujeros-container');
        agCont.innerHTML = '';
        const posiciones = [
            { left: 20, top: 20 },
            { left: 80, top: 20 },
            { left: 20, top: 80 },
            { left: 80, top: 80 }
        ];
        posiciones.forEach(pos => {
            let div = document.createElement('div');
            div.className = 'hoyo';
            div.style.left = pos.left + "%";
            div.style.top = pos.top + "%";
            agCont.appendChild(div);
        });
    }

    function spawnPersonaje() {
        if (!juegoActivo) return;

        let rand = Math.random();
        let acumulado = 0;
        let tipoElegido = tiposPersonajes[0];

        for (const tipo of tiposPersonajes) {
            acumulado += tipo.prob;
            if (rand <= acumulado) {
                tipoElegido = tipo;
                break;
            }
        }

        let charX = 10 + Math.random() * 80;
        let charY = 10 + Math.random() * 80;
        // Evitar spawnear muy cerca del centro (donde inicia el jugador)
        if (Math.abs(charX - 50) < 10 && Math.abs(charY - 50) < 10) return;

        let id = Date.now() + Math.random();
        let div = document.createElement('div');
        div.className = 'personaje';
        div.id = 'char-' + id;
        div.style.left = charX + "%";
        div.style.top = charY + "%";
        div.innerText = tipoElegido.emoji;
        document.getElementById('personajes-container').appendChild(div);

        personajesEnJuego[id] = {
            x: charX, y: charY,
            vx: (Math.random() - 0.5) * tipoElegido.speed,
            vy: (Math.random() - 0.5) * tipoElegido.speed,
            tipo: tipoElegido
        };
    }

    function contarTiempo() {
        if (!juegoActivo) return;
        if (segundos <= 0) {
            finalizarJuego(true);
        } else {
            segundos--;
            document.getElementById('segundos').innerText = segundos;
            setTimeout(contarTiempo, 1000);
        }
    }

    function gameLoop() {
        if (!juegoActivo) return;

        // F√çSICA DE MOVIMIENTO
        vx += incliX * 0.08; // Sensibilidad X
        vy += incliY * 0.08; // Sensibilidad Y
        
        // Fricci√≥n (simulando pasto/hielo)
        vx *= 0.92; 
        vy *= 0.92;
        
        x += vx * 0.1; 
        y += vy * 0.1;

        // C√ÅLCULO DE ROTACI√ìN (EFECTO RODAR)
        // La velocidad total es la hipotenusa de vx y vy
        let velocidad = Math.sqrt(vx*vx + vy*vy);
        // Acumulamos rotaci√≥n basada en la velocidad. 
        // El factor 5 ajusta qu√© tan r√°pido gira visualmente.
        rotacionAcumulada += velocidad * 5;

        // ACTUALIZAR DOM DEL BAL√ìN
        const pelota = document.getElementById('pelota');
        const tablero = document.getElementById('tablero');
        
        pelota.style.left = x + "%";
        pelota.style.top = y + "%";
        // Aplicamos la rotaci√≥n. Nota: translate(-50%, -50%) es necesario para mantener el centro.
        pelota.style.transform = `translate(-50%, -50%) rotate(${rotacionAcumulada}deg)`;

        // Inclinaci√≥n visual del tablero 3D
        tablero.style.transform = `rotateX(${-incliY*0.3}deg) rotateY(${incliX*0.3}deg)`;

        // COLISIONES CON PERSONAJES
        for (let id in personajesEnJuego) {
            let p = personajesEnJuego[id];
            
            // Mover personajes (rebote suave)
            p.x += p.vx; p.y += p.vy;
            if (p.x < 5 || p.x > 95) p.vx *= -1;
            if (p.y < 5 || p.y > 95) p.vy *= -1;

            const charDiv = document.getElementById('char-' + id);
            if (charDiv) {
                charDiv.style.left = p.x + "%";
                charDiv.style.top = p.y + "%";

                // Distancia entre bal√≥n y personaje
                let dist = Math.sqrt(Math.pow(x - p.x, 2) + Math.pow(y - p.y, 2));
                
                // Radio de colisi√≥n (Bal√≥n ~5% ancho, Personaje ~4% ancho)
                if (dist < 6) { 
                    puntos += p.tipo.valor;
                    document.getElementById('puntos').innerText = puntos;
                    
                    if (p.tipo.valor > 0) hablar(frasesPositivas[Math.floor(Math.random()*frasesPositivas.length)]);
                    else hablar(frasesNegativas[Math.floor(Math.random()*frasesNegativas.length)]);

                    charDiv.remove();
                    delete personajesEnJuego[id];
                }
            }
        }

        // COLISI√ìN CON HOYOS
        const hoyos = document.querySelectorAll('.hoyo');
        hoyos.forEach(hoyo => {
            let hoyoRect = hoyo.getBoundingClientRect();
            let tableroRect = tablero.getBoundingClientRect();
            
            // Convertir posici√≥n del hoyo a porcentaje relativo al tablero
            let hoyoX = ((hoyoRect.left + hoyoRect.width/2 - tableroRect.left) / tableroRect.width) * 100;
            let hoyoY = ((hoyoRect.top + hoyoRect.height/2 - tableroRect.top) / tableroRect.height) * 100;

            let distHoyo = Math.sqrt(Math.pow(x - hoyoX, 2) + Math.pow(y - hoyoY, 2));
            
            if (distHoyo < 4) { // Si cae en el hoyo
                finalizarJuego(false);
            }
        });

        // L√çMITES DE CANCHA
        if (x < 2 || x > 98 || y < 2 || y > 98) {
            vx *= -1; vy *= -1; // Rebote en paredes en lugar de muerte instant√°nea
            x = Math.max(2, Math.min(98, x));
            y = Math.max(2, Math.min(98, y));
        }

        requestAnimationFrame(gameLoop);
    }

    function finalizarJuego(ganaste) {
        juegoActivo = false;
        let mensaje = ganaste ? 
            `¬°TIEMPO! Puntuaci√≥n final: ${puntos}` : 
            `¬°CA√çSTE! Fin del juego.`;
            
        alert(mensaje);
        location.reload();
    }
</script>
</body>
</html>
