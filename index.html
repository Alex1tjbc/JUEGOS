<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cazador de Personajes</title>
    <style>
        :root { 
            --borde-dorado: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%);
            --hielo: radial-gradient(circle at 50% 50%, #e0f2f7 0%, #b3e5fc 50%, #81d4fa 100%);
            --agujero-vortex: #0a0a0a;
            --sombra-pelota: rgba(0,0,0,0.6);
            --fondo-oscuro: #1a1a1a;
        }
        body { 
            margin: 0; padding: 0; overflow: hidden; 
            background: var(--fondo-oscuro); font-family: 'Segoe UI', sans-serif; 
            perspective: 1200px;
        }
        
        #escenario { width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }

        #tablero {
            width: 90vw; height: 130vw; background: var(--hielo);
            border: 20px solid transparent; border-image: var(--borde-dorado) 30;
            border-radius: 25px; position: relative;
            box-shadow: 0 50px 100px rgba(0,0,0,0.8);
            transform-style: preserve-3d;
        }

        .hoyo {
            position: absolute; width: 75px; height: 75px; background: var(--agujero-vortex);
            border-radius: 50%; box-shadow: inset 0 10px 20px #000, 0 0 15px rgba(255,0,0,0.5);
            transform: translate(-50%, -50%);
            animation: vortex 2s linear infinite; /* Animaci√≥n de remolino */
        }
        @keyframes vortex { to { transform: translate(-50%, -50%) rotate(360deg); } }

        .personaje {
            position: absolute; font-size: 38px; transform: translate(-50%, -50%);
            z-index: 8; transition: all 0.4s ease-out; /* Animaci√≥n suave al moverse */
            pointer-events: none; /* No bloquea la pelota */
        }

        #pelota {
            width: 55px; height: 55px; position: absolute; 
            transform: translate(-50%, -50%); font-size: 45px;
            display: flex; align-items: center; justify-content: center;
            z-index: 10; filter: drop_shadow(0 12px 8px var(--sombra-pelota));
            animation: rodar 0.1s linear infinite; /* Simula rodar */
        }
        @keyframes rodar { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }

        #pelota::after { /* Efecto de rastro de humo */
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 30px; height: 30px; background: rgba(255,255,255,0.2);
            border-radius: 50%; filter: blur(10px); opacity: 0;
            animation: humo 1s forwards;
            pointer-events: none;
        }
        @keyframes humo {
            0% { transform: scale(0); opacity: 0.8; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        #ui { position: fixed; top: 10px; width: 100%; text-align: center; color: white; z-index: 100; text-shadow: 2px 2px 4px #000; }
        #puntos-ui { font-size: 1.8rem; font-weight: bold; color: #76ff03; }
        #timer-ui { font-size: 3.5rem; font-weight: bold; margin: 5px 0; color: #00e5ff; }
        #dialogo { font-size: 1.2rem; background: rgba(0,0,0,0.6); padding: 8px 15px; border-radius: 10px; display: inline-block; min-width: 200px; }
        
        .overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.95); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 1000; color: white;
        }
        .btn { padding: 25px 60px; font-size: 1.8rem; background: var(--borde-dorado); color: #000; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="ui">
    <div id="puntos-ui">Puntos: <span id="puntos">0</span></div>
    <div id="timer-ui"><span id="segundos">60</span>s</div>
    <p id="dialogo">¬°A atrapar a todos!</p>
</div>

<div id="escenario">
    <div id="tablero">
        <div id="agujeros-container"></div>
        <div id="personajes-container"></div>
        <div id="pelota">‚òÑÔ∏è</div>
    </div>
</div>

<div id="intro" class="overlay">
    <h1 style="color:#00e5ff; font-size:3rem;">¬°CAZADOR DE EMOTES!</h1>
    <p style="text-align:center; padding:0 20px;">
        Gu√≠a tu meteorito para atrapar a los emojis.<br>
        ¬°Pero cuidado! Si caes al hoyo, pierdes todos tus puntos.
    </p>
    <button class="btn" onclick="iniciarJuego()">¬°QUE COMIENCE LA CAZA!</button>
</div>

<script>
    let x = 50, y = 20, vx = 0, vy = 0;
    let incliX = 0, incliY = 0, juegoActivo = false;
    let puntos = 0, segundos = 60;
    
    // Lista de personajes y sus valores
    const tiposPersonajes = [
        { emoji: "üòÄ", valor: 10, prob: 0.4, speed: 0.5 },
        { emoji: "üòé", valor: 20, prob: 0.3, speed: 0.8 },
        { emoji: "üöÄ", valor: 50, prob: 0.2, speed: 1.2 },
        { emoji: "üëΩ", valor: -30, prob: 0.1, speed: 1.0 } // Alien es el villano
    ];

    let personajesEnJuego = {}; // Almacena los personajes en el tablero

    const frasesIntro = ["¬°Bienvenidos, cazadores!", "¬°Que gane el mejor!", "¬øListo para el reto?"];
    const frasesAtrapar = ["¬°Bien hecho!", "¬°Puntos para la casa!", "¬°Otro m√°s a la bolsa!"];
    const frasesAlien = ["¬°Oh no, un alien√≠gena!", "¬°Te rob√≥ puntos!", "¬°Cuidado con esos extraterrestres!"];
    const frasesPerder = ["¬°Vaya, qu√© l√°stima! Puntos perdidos.", "¬°Al hoyo! Mejor suerte la pr√≥xima.", "¬°El tablero te gan√≥!"];
    const frasesGanar = ["¬°Incre√≠ble! ¬°Eres el cazador definitivo!", "¬°Puntuaci√≥n r√©cord!", "¬°Victoria contundente!"];

    function hablar(listaFrases, personalizada = false) {
        window.speechSynthesis.cancel();
        let texto = personalizada ? listaFrases : listaFrases[Math.floor(Math.random() * listaFrases.length)];
        let m = new SpeechSynthesisUtterance(texto);
        m.lang = 'es-MX'; 
        m.pitch = 1.0; // Voz neutral
        m.rate = 1.0;  // Velocidad normal
        document.getElementById('dialogo').innerText = texto;
        window.speechSynthesis.speak(m);
    }

    async function iniciarJuego() {
        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            const res = await DeviceOrientationEvent.requestPermission();
            if (res === 'granted') arrancarJuego();
        } else { arrancarJuego(); }
    }

    function arrancarJuego() {
        document.getElementById('intro').style.display = 'none';
        juegoActivo = true;
        window.addEventListener('deviceorientation', e => { incliX = e.gamma; incliY = e.beta; });
        actualizarUI();
        generarAgujeros();
        setInterval(spawnPersonaje, 2000); // Genera personajes cada 2 segundos
        contarTiempo();
        gameLoop();
    }

    function generarAgujeros() {
        const agCont = document.getElementById('agujeros-container');
        agCont.innerHTML = '';
        // Puedes hacer que la cantidad y posici√≥n de agujeros cambie por nivel si quieres.
        const numHoyos = 6;
        for (let i = 0; i < numHoyos; i++) {
            let div = document.createElement('div');
            div.className = 'hoyo';
            div.style.left = (15 + Math.random() * 70) + "%";
            div.style.top = (15 + Math.random() * 70) + "%";
            agCont.appendChild(div);
        }
    }

    function spawnPersonaje() {
        if (!juegoActivo) return;

        let tipoElegido = null;
        let rand = Math.random();
        let acumulado = 0;

        for (const tipo of tiposPersonajes) {
            acumulado += tipo.prob;
            if (rand <= acumulado) {
                tipoElegido = tipo;
                break;
            }
        }
        if (!tipoElegido) return;

        let charX = 10 + Math.random() * 80;
        let charY = 10 + Math.random() * 80;
        let id = Date.now().toString() + Math.random();

        let div = document.createElement('div');
        div.className = 'personaje';
        div.id = 'char-' + id;
        div.style.left = charX + "%";
        div.style.top = charY + "%";
        div.innerText = tipoElegido.emoji;
        document.getElementById('personajes-container').appendChild(div);

        personajesEnJuego[id] = {
            x: charX, y: charY,
            vx: (Math.random() - 0.5) * tipoElegido.speed * 2,
            vy: (Math.random() - 0.5) * tipoElegido.speed * 2,
            tipo: tipoElegido
        };
    }

    function actualizarUI() {
        document.getElementById('puntos').innerText = puntos;
        document.getElementById('segundos').innerText = segundos;
    }

    function contarTiempo() {
        if (!juegoActivo) return;
        if (segundos <= 0) {
            juegoActivo = false;
            hablar(frasesGanar);
            setTimeout(() => alert(`¬°Tiempo terminado! Tu puntuaci√≥n final es: ${puntos}`), 1000);
            setTimeout(() => location.reload(), 3000);
        } else {
            segundos--;
            actualizarUI();
            setTimeout(contarTiempo, 1000);
        }
    }

    function gameLoop() {
        if (!juegoActivo) return;

        // Movimiento de la pelota
        vx += incliX * 0.05;
        vy += incliY * 0.05;
        vx *= 0.95; vy *= 0.95;
        x += vx * 0.2; y += vy * 0.2;

        const pelota = document.getElementById('pelota');
        const tablero = document.getElementById('tablero');
        pelota.style.left = x + "%";
        pelota.style.top = y + "%";
        pelota.style.transform = `translate(-50%, -50%) rotate(${x+y}deg)`; // Simula rotaci√≥n

        // Inclinaci√≥n 3D del tablero
        tablero.style.transform = `rotateX(${-incliY*0.4}deg) rotateY(${incliX*0.4}deg)`;

        // Movimiento y colisiones de personajes
        for (let id in personajesEnJuego) {
            let p = personajesEnJuego[id];
            
            p.x += p.vx;
            p.y += p.vy;

            // Rebote en los bordes del tablero para personajes
            if (p.x < 5 || p.x > 95) p.vx *= -1;
            if (p.y < 5 || p.y > 95) p.vy *= -1;

            p.x = Math.max(5, Math.min(95, p.x));
            p.y = Math.max(5, Math.min(95, p.y));

            const charDiv = document.getElementById('char-' + id);
            if (charDiv) {
                charDiv.style.left = p.x + "%";
                charDiv.style.top = p.y + "%";

                // Colisi√≥n pelota con personaje
                let dist = Math.sqrt(Math.pow(x - p.x, 2) + Math.pow(y - p.y, 2));
                if (dist < 6) { // Radio de colisi√≥n
                    puntos += p.tipo.valor;
                    if (p.tipo.valor < 0) { hablar(frasesAlien); } 
                    else { hablar(frasesAtrapar); }
                    actualizarUI();
                    charDiv.remove();
                    delete personajesEnJuego[id];
                }
            }
        }

        // Colisi√≥n con agujeros
        const hoyos = document.querySelectorAll('.hoyo');
        hoyos.forEach(hoyo => {
            let hoyoRect = hoyo.getBoundingClientRect();
            let tableroRect = tablero.getBoundingClientRect();
            
            // Convertir coordenadas del hoyo a porcentaje del tablero
            let hoyoCenterX = ((hoyoRect.left + hoyoRect.width / 2 - tableroRect.left) / tableroRect.width) * 100;
            let hoyoCenterY = ((hoyoRect.top + hoyoRect.height / 2 - tableroRect.top) / tableroRect.height) * 100;

            let distHoyo = Math.sqrt(Math.pow(x - hoyoCenterX, 2) + Math.pow(y - hoyoCenterY, 2));
            if (distHoyo < 6) { // Radio de colisi√≥n con hoyo
                perderJuego();
            }
        });

        // Colisi√≥n con bordes del tablero principal
        if (x < 3 || x > 97 || y < 3 || y > 97) { // M√°rgenes m√°s ajustados para el borde del tablero
            perderJuego();
        }

        requestAnimationFrame(gameLoop);
    }

    function perderJuego() {
        juegoActivo = false;
        hablar(frasesPerder);
        setTimeout(() => alert(`¬°GAME OVER! Perdiste todos tus ${puntos} puntos.`), 1000);
        setTimeout(() => location.reload(), 3000);
    }
</script>
</body>
</html>
