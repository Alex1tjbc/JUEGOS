<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cazador de Personajes</title>
    <style>
        :root { 
            --borde-dorado: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%);
            --hielo: radial-gradient(circle at 30% 30%, #e3f2fd 0%, #90caf9 40%, #42a5f5 100%);
            --agujero-vortex: radial-gradient(circle, #1a0033 0%, #000000 70%);
            --sombra-pelota: rgba(255,100,0,0.7);
            --fondo-oscuro: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);
        }
        body { 
            margin: 0; padding: 0; overflow: hidden; 
            background: var(--fondo-oscuro); 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            perspective: 1500px;
        }
        
        #escenario { width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }

        #tablero {
            width: 90vw; height: 130vw; 
            background: var(--hielo);
            border: 22px solid transparent; 
            border-image: var(--borde-dorado) 30;
            border-radius: 30px; 
            position: relative;
            box-shadow: 
                0 50px 100px rgba(0,0,0,0.9),
                inset 0 0 80px rgba(255,255,255,0.1),
                0 0 40px rgba(255,215,0,0.3);
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }

        .hoyo {
            position: absolute; 
            width: 60px; 
            height: 60px; 
            background: var(--agujero-vortex);
            border-radius: 50%; 
            box-shadow: 
                inset 0 15px 30px rgba(0,0,0,0.9), 
                0 0 25px rgba(138,43,226,0.6),
                0 0 40px rgba(75,0,130,0.4);
            transform: translate(-50%, -50%);
            animation: vortex 3s ease-in-out infinite;
            overflow: hidden;
        }
        .hoyo::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 150%;
            height: 150%;
            background: conic-gradient(from 0deg, transparent 0%, rgba(138,43,226,0.3) 50%, transparent 100%);
            transform: translate(-50%, -50%);
            animation: spin 2s linear infinite;
        }
        @keyframes vortex { 
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        @keyframes spin {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .personaje {
            position: absolute; 
            font-size: 42px; 
            transform: translate(-50%, -50%);
            z-index: 8; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4));
            animation: flotar 2s ease-in-out infinite;
        }
        @keyframes flotar {
            0%, 100% { transform: translate(-50%, -50%) translateY(0px); }
            50% { transform: translate(-50%, -50%) translateY(-5px); }
        }

        #pelota {
            width: 58px; 
            height: 58px; 
            position: absolute; 
            transform: translate(-50%, -50%); 
            font-size: 48px;
            display: flex; 
            align-items: center; 
            justify-content: center;
            z-index: 10; 
            filter: drop-shadow(0 15px 12px var(--sombra-pelota))
                    drop-shadow(0 0 20px rgba(255,150,0,0.5));
            animation: meteoroPulso 1.5s ease-in-out infinite;
        }
        @keyframes meteoroPulso {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.08); }
        }

        #pelota::after {
            content: ''; 
            position: absolute; 
            top: 50%; 
            left: 50%;
            width: 35px; 
            height: 35px; 
            background: radial-gradient(circle, rgba(255,150,50,0.4) 0%, transparent 70%);
            border-radius: 50%; 
            filter: blur(12px); 
            opacity: 0;
            animation: estela 0.8s ease-out infinite;
            pointer-events: none;
            z-index: -1;
        }
        @keyframes estela {
            0% { 
                transform: translate(-50%, -50%) scale(0.5); 
                opacity: 0.9; 
            }
            100% { 
                transform: translate(-50%, -50%) scale(2) translateX(-30px); 
                opacity: 0; 
            }
        }

        #ui { 
            position: fixed; 
            top: 15px; 
            width: 100%; 
            text-align: center; 
            color: white; 
            z-index: 100; 
            text-shadow: 0 0 10px rgba(0,0,0,0.8), 0 4px 6px rgba(0,0,0,0.6); 
        }
        #puntos-ui { 
            font-size: 2rem; 
            font-weight: bold; 
            color: #76ff03; 
            text-shadow: 0 0 15px rgba(118,255,3,0.6);
        }
        #timer-ui { 
            font-size: 3.8rem; 
            font-weight: bold; 
            margin: 8px 0; 
            color: #00e5ff; 
            text-shadow: 0 0 20px rgba(0,229,255,0.8);
            animation: timerPulso 1s ease-in-out infinite;
        }
        @keyframes timerPulso {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        #dialogo { 
            font-size: 1.3rem; 
            background: rgba(0,0,0,0.75); 
            padding: 12px 20px; 
            border-radius: 15px; 
            display: inline-block; 
            min-width: 250px; 
            border: 2px solid rgba(255,215,0,0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        
        .overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(20,20,40,0.97) 100%);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 1000; color: white;
        }
        .btn { 
            padding: 25px 60px; 
            font-size: 1.8rem; 
            background: var(--borde-dorado); 
            color: #000; 
            border: none; 
            border-radius: 50px; 
            font-weight: bold; 
            cursor: pointer; 
            box-shadow: 0 10px 30px rgba(255,215,0,0.4);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .btn:active {
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(255,215,0,0.6);
        }
    </style>
</head>
<body>

<div id="ui">
    <div id="puntos-ui">Puntos: <span id="puntos">0</span></div>
    <div id="timer-ui"><span id="segundos">60</span>s</div>
    <p id="dialogo">¬°A atrapar a todos!</p>
</div>

<div id="escenario">
    <div id="tablero">
        <div id="agujeros-container"></div>
        <div id="personajes-container"></div>
        <div id="pelota">‚òÑÔ∏è</div>
    </div>
</div>

<div id="intro" class="overlay">
    <h1 style="color:#00e5ff; font-size:3rem; text-shadow: 0 0 20px rgba(0,229,255,0.8);">¬°CAZADOR DE EMOTES!</h1>
    <p style="text-align:center; padding:0 20px; font-size:1.2rem; line-height: 1.6;">
        Gu√≠a tu meteorito para atrapar a los emojis.<br>
        <span style="color:#76ff03;">üòÄ = 10pts</span> | 
        <span style="color:#00e5ff;">üòé = 20pts</span> | 
        <span style="color:#ffd700;">üöÄ = 50pts</span> | 
        <span style="color:#ff1744;">üëΩ = -30pts</span><br>
        <strong style="color:#ff5252;">¬°Cuidado! Si caes al hoyo, pierdes todos tus puntos.</strong>
    </p>
    <button class="btn" onclick="iniciarJuego()">¬°QUE COMIENCE LA CAZA!</button>
</div>

<script>
    let x = 50, y = 20, vx = 0, vy = 0;
    let incliX = 0, incliY = 0, juegoActivo = false;
    let puntos = 0, segundos = 60;
    
    const tiposPersonajes = [
        { emoji: "üòÄ", valor: 10, prob: 0.4, speed: 0.5 },
        { emoji: "üòé", valor: 20, prob: 0.3, speed: 0.8 },
        { emoji: "üöÄ", valor: 50, prob: 0.2, speed: 1.2 },
        { emoji: "üëΩ", valor: -30, prob: 0.1, speed: 1.0 }
    ];

    let personajesEnJuego = {};

    const frasesIntro = ["¬°Bienvenidos, cazadores!", "¬°Que gane el mejor!", "¬øListo para el reto?"];
    const frasesAtrapar = ["¬°Bien hecho!", "¬°Puntos para la casa!", "¬°Otro m√°s a la bolsa!", "¬°Excelente captura!"];
    const frasesAlien = ["¬°Oh no, un alien√≠gena!", "¬°Te rob√≥ puntos!", "¬°Cuidado con esos extraterrestres!"];
    const frasesPerder = ["¬°Vaya, qu√© l√°stima! Puntos perdidos.", "¬°Al hoyo! Mejor suerte la pr√≥xima.", "¬°El tablero te gan√≥!"];
    const frasesGanar = ["¬°Incre√≠ble! ¬°Eres el cazador definitivo!", "¬°Puntuaci√≥n r√©cord!", "¬°Victoria contundente!"];

    function hablar(listaFrases, personalizada = false) {
        window.speechSynthesis.cancel();
        let texto = personalizada ? listaFrases : listaFrases[Math.floor(Math.random() * listaFrases.length)];
        let m = new SpeechSynthesisUtterance(texto);
        m.lang = 'es-MX'; 
        m.pitch = 1.0;
        m.rate = 1.0;
        document.getElementById('dialogo').innerText = texto;
        window.speechSynthesis.speak(m);
    }

    async function iniciarJuego() {
        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            const res = await DeviceOrientationEvent.requestPermission();
            if (res === 'granted') arrancarJuego();
        } else { arrancarJuego(); }
    }

    function arrancarJuego() {
        document.getElementById('intro').style.display = 'none';
        juegoActivo = true;
        window.addEventListener('deviceorientation', e => { incliX = e.gamma; incliY = e.beta; });
        actualizarUI();
        generarAgujeros();
        setInterval(spawnPersonaje, 2000);
        contarTiempo();
        hablar(frasesIntro);
        gameLoop();
    }

    function generarAgujeros() {
        const agCont = document.getElementById('agujeros-container');
        agCont.innerHTML = '';
        const numHoyos = 3; // Reducido a solo 3 hoyos
        const posiciones = [
            { left: 25, top: 30 },
            { left: 75, top: 50 },
            { left: 50, top: 75 }
        ];
        for (let i = 0; i < numHoyos; i++) {
            let div = document.createElement('div');
            div.className = 'hoyo';
            div.style.left = posiciones[i].left + "%";
            div.style.top = posiciones[i].top + "%";
            agCont.appendChild(div);
        }
    }

    function spawnPersonaje() {
        if (!juegoActivo) return;

        let tipoElegido = null;
        let rand = Math.random();
        let acumulado = 0;

        for (const tipo of tiposPersonajes) {
            acumulado += tipo.prob;
            if (rand <= acumulado) {
                tipoElegido = tipo;
                break;
            }
        }
        if (!tipoElegido) return;

        let charX = 10 + Math.random() * 80;
        let charY = 10 + Math.random() * 80;
        let id = Date.now().toString() + Math.random();

        let div = document.createElement('div');
        div.className = 'personaje';
        div.id = 'char-' + id;
        div.style.left = charX + "%";
        div.style.top = charY + "%";
        div.innerText = tipoElegido.emoji;
        document.getElementById('personajes-container').appendChild(div);

        personajesEnJuego[id] = {
            x: charX, y: charY,
            vx: (Math.random() - 0.5) * tipoElegido.speed * 2,
            vy: (Math.random() - 0.5) * tipoElegido.speed * 2,
            tipo: tipoElegido
        };
    }

    function actualizarUI() {
        document.getElementById('puntos').innerText = puntos;
        document.getElementById('segundos').innerText = segundos;
    }

    function contarTiempo() {
        if (!juegoActivo) return;
        if (segundos <= 0) {
            juegoActivo = false;
            hablar(frasesGanar);
            setTimeout(() => alert(`¬°Tiempo terminado! Tu puntuaci√≥n final es: ${puntos}`), 1000);
            setTimeout(() => location.reload(), 3000);
        } else {
            segundos--;
            actualizarUI();
            setTimeout(contarTiempo, 1000);
        }
    }

    function gameLoop() {
        if (!juegoActivo) return;

        vx += incliX * 0.05;
        vy += incliY * 0.05;
        vx *= 0.95; vy *= 0.95;
        x += vx * 0.2; y += vy * 0.2;

        const pelota = document.getElementById('pelota');
        const tablero = document.getElementById('tablero');
        pelota.style.left = x + "%";
        pelota.style.top = y + "%";

        tablero.style.transform = `rotateX(${-incliY*0.4}deg) rotateY(${incliX*0.4}deg)`;

        for (let id in personajesEnJuego) {
            let p = personajesEnJuego[id];
            
            p.x += p.vx;
            p.y += p.vy;

            if (p.x < 5 || p.x > 95) p.vx *= -1;
            if (p.y < 5 || p.y > 95) p.vy *= -1;

            p.x = Math.max(5, Math.min(95, p.x));
            p.y = Math.max(5, Math.min(95, p.y));

            const charDiv = document.getElementById('char-' + id);
            if (charDiv) {
                charDiv.style.left = p.x + "%";
                charDiv.style.top = p.y + "%";

                let dist = Math.sqrt(Math.pow(x - p.x, 2) + Math.pow(y - p.y, 2));
                if (dist < 6) {
                    puntos += p.tipo.valor;
                    if (p.tipo.valor < 0) { hablar(frasesAlien); } 
                    else { hablar(frasesAtrapar); }
                    actualizarUI();
                    charDiv.remove();
                    delete personajesEnJuego[id];
                }
            }
        }

        const hoyos = document.querySelectorAll('.hoyo');
        hoyos.forEach(hoyo => {
            let hoyoRect = hoyo.getBoundingClientRect();
            let tableroRect = tablero.getBoundingClientRect();
            
            let hoyoCenterX = ((hoyoRect.left + hoyoRect.width / 2 - tableroRect.left) / tableroRect.width) * 100;
            let hoyoCenterY = ((hoyoRect.top + hoyoRect.height / 2 - tableroRect.top) / tableroRect.height) * 100;

            let distHoyo = Math.sqrt(Math.pow(x - hoyoCenterX, 2) + Math.pow(y - hoyoCenterY, 2));
            if (distHoyo < 5) { // Radio de colisi√≥n reducido
                perderJuego();
            }
        });

        if (x < 3 || x > 97 || y < 3 || y > 97) {
            perderJuego();
        }

        requestAnimationFrame(gameLoop);
    }

    function perderJuego() {
        juegoActivo = false;
        hablar(frasesPerder);
        setTimeout(() => alert(`¬°GAME OVER! Perdiste todos tus ${puntos} puntos.`), 1000);
        setTimeout(() => location.reload(), 3000);
    }
</script>
</body>
</html>
